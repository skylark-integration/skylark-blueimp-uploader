/**
 * skylark-blueimp-uploader - The skylark file uploader
 * @author Hudaokeji, Inc.
 * @version v0.0.1
 * @link https://github.com/skylark-integration/skylark-blueimp-uploader/
 * @license MIT
 */
!function(e,t){var i=t.define,n=t.require,r="function"==typeof i&&i.amd,s=!r&&"undefined"!=typeof exports;if(!r&&!i){var o={};i=t.define=function(e,t,i){"function"==typeof i?(o[e]={factory:i,deps:t.map(function(t){return function(e,t){if("."!==e[0])return e;var i=t.split("/"),n=e.split("/");i.pop();for(var r=0;r<n.length;r++)"."!=n[r]&&(".."==n[r]?i.pop():i.push(n[r]));return i.join("/")}(t,e)}),resolved:!1,exports:null},n(e)):o[e]={factory:null,resolved:!0,exports:i}},n=t.require=function(e){if(!o.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var i=o[e];if(!i.resolved){var r=[];i.deps.forEach(function(e){r.push(n(e))}),i.exports=i.factory.apply(t,r)||null,i.resolved=!0}return i.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(e,t){e("skylark-blueimp-uploader/tmpl",["skylark-langx/langx"],function(e){"use strict";var t=function(e,i){var n=/[^\w\-.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return i?n(i,t):function(e){return n(e,t)}};return t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?!(?:[^{]|\{(?!%))*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,i,n,r,s){return t?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"==null?'':"+n+")+'":r?"';":s?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return(null==e?"":""+e).replace(t.encReg,function(e){return t.encMap[e]||""})},t.arg="o",t.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}",t}),e("skylark-blueimp-uploader/fileupload",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-utils-filer","skylark-jquery","skylark-jqueryui/widget"],function(e,t,i,n){"use strict";var r=e.Deferred;return n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:n(document),picker:void 0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!1,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&n(this).fileupload("instance").option("autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["picker","dropZone","pasteZone","multipart"],_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=(t-this.loaded)*(1e3/n)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,i){if(e.lengthComputable){var n,r=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&e.loaded!==e.total)return;i._time=r,n=Math.floor(e.loaded/e.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=n-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=n,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,n,i.bitrateInterval),this._trigger("progress",t.create("progress",{delegatedEvent:e}),i),this._trigger("progressall",t.create("progressall",{delegatedEvent:e}),this._progress)}},_getParamName:function(t){n(t.picker);var i=t.paramName;return e.isArray(i)||(i=[i]),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(e,t,i){var n=new r,s=n.promise;return t=t||this.options.context||s,!0===e?n.resolveWith(t,i):!1===e&&n.rejectWith(t,i),s.abort=n.promise,this._enhancePromise(s)},_addConvenienceMethods:function(e,i){var n=this,s=function(e){return(new r).resolveWith(n,e).promise};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||s([this])).pipe(function(){return i.errorThrown?(new r).rejectWith(n,[i]).promise:s(arguments)}).pipe(e,t)),this._processQueue||s([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==n._trigger("submit",t.create("submit",{delegatedEvent:e}),this)&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",n._trigger("fail",null,this),n._getXHRPromise(!1))},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===n._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(e,i,n,r){var s=r._progress.total,o=r._response;r._progress.loaded<s&&this._onProgress(t.create("progress",{lengthComputable:!0,loaded:s,total:s}),r),o.result=r.result=e,o.textStatus=r.textStatus=i,o.jqXHR=r.jqXHR=n,this._trigger("done",null,r)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(e,t){t.submit||this._addConvenienceMethods(e,t);var n,r=this;return this._beforeSend(e,t),r._sending+=1,t.url=r.options.url,t.dataType=r.options.dataType,t.xhrFields=r.options.xhrFields,(n=i.upload(t)).progress(function(e){r._onProgress(e,n.options)}).done(function(e,t){r._onDone(e,t,n,n.options)}).fail(function(e,t){r._onFail(n,t,e,n.options)}).always(function(){r._sending-=1,r._active-=1,r._trigger("stop")}),n},_onAdd:function(i,n){var r,s,o,a,l=this,d=!0,u=e.extend({},this.options,n),p=n.files,c=p.length,f=u.limitMultiFileUploads,h=u.limitMultiFileUploadSize,g=u.limitMultiFileUploadSizeOverhead,m=0,_=this._getParamName(u),v=0;if(!h||c&&void 0!==p[0].size||(h=void 0),u.singleFileUploads||f||h)if(u.singleFileUploads||h||!f)if(!u.singleFileUploads&&h)for(o=[],r=[],a=0;a<c;a+=1)m+=p[a].size+g,(a+1===c||m+p[a+1].size+g>h||f&&a+1-v>=f)&&(o.push(p.slice(v,a+1)),(s=_.slice(v,a+1)).length||(s=_),r.push(s),v=a+1,m=0);else r=_;else for(o=[],r=[],a=0;a<c;a+=f)o.push(p.slice(a,a+f)),(s=_.slice(a,a+f)).length||(s=_),r.push(s);else o=[p],r=[_];return n.originalFiles=p,e.each(o||p,function(s,a){var u=e.extend({},n);return u.files=o?a:[a],u.paramName=r[s],l._initResponseObject(u),l._initProgressObject(u),l._addConvenienceMethods(i,u),d=l._trigger("add",t.create("add",{delegatedEvent:i}),u)}),d},_initEventHandlers:function(){var e=this;i.dropzone(this.options.dropZone[0],{dropped:function(t){var i={};i.files=t,e._onAdd(null,i)}}),i.pastezone(this.options.pasteZone[0],{pasted:function(t){var i={};i.files=t,e._onAdd(null,i)}}),i.picker(this.options.picker[0],{multiple:!0,picked:function(t){var i={};i.files=t,e._onAdd(null,i)}})},_destroyEventHandlers:function(){},_setOption:function(t,i){var n=-1!==e.inArray(t,this._specialOptions);n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;e.picker&&(e.picker instanceof n||(e.picker=n(e.picker))),e.dropZone&&(e.dropZone instanceof n||(e.dropZone=n(e.dropZone))),e.pasteZone&&(e.pasteZone instanceof n||(e.pasteZone=n(e.pasteZone)))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_create:function(){this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){t&&!this.options.disabled&&(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){return t&&!this.options.disabled&&(t.files=e.makeArray(t.files),t.files.length)?this._onSend(null,t):this._getXHRPromise(!1,t&&t.context)}}),n}),e("skylark-blueimp-uploader/fileupload-ui",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-jquery","./tmpl","./fileupload"],function(e,t,i,n){"use strict";return i.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),i.widget("blueimp.fileuploadui",{processActions:{},_processFile:function(e,t){var n=i.skylark.langx,r=this,s=n.map(e.processQueue,function(e){return function(t){return r.processActions[e.action].call(r,t,e)}});return n.async.waterful(s,[e],r)},_transformProcessQueue:function(e){var t=[];i.each(e.processQueue,function(){var n={},r=this.action,s=!0===this.prefix?r:this.prefix;i.each(this,function(t,r){"string"===i.type(r)&&"@"===r.charAt(0)?n[t]=e[r.slice(1)||(s?s+t.charAt(0).toUpperCase()+t.slice(1):t)]:n[t]=r}),t.push(n)}),e.processQueue=t},processing:function(){return this._processing},process:function(e){var t=this,n=i.extend({},this.options,e);return n.processQueue&&n.processQueue.length&&(this._transformProcessQueue(n),0===this._processing&&this._trigger("processstart"),i.each(e.files,function(r){var s=r?i.extend({},n):n,o=function(){return e.errorThrown?i.Deferred().rejectWith(t,[e]).promise():t._processFile(s,e)};s.index=r,t._processing+=1,t._processingQueue=t._processingQueue.pipe(o,o).always(function(){t._processing-=1,0===t._processing&&t._trigger("processstop")})})),this._processingQueue},options:{processQueue:[],autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(e){return e.result&&i.isArray(e.result.files)?e.result.files:[]},add:function(e,t){var n=i(this),r=n.data("blueimp-fileuploadui")||n.data("fileupload"),s=r.options;t.context=r._renderUpload(t.files).data("data",t).addClass("processing"),s.filesContainer[s.prependFiles?"prepend":"append"](t.context),r._forceReflow(t.context),r._transition(t.context),n.fileuploadui("process",t).always(function(){t.context.each(function(e){i(this).find(".size").text(r._formatFileSize(t.files[e].size))}).removeClass("processing"),r._renderPreviews(t)}).done(function(){t.context.find(".start").prop("disabled",!1),!1!==r._trigger("added",null,t)&&(s.autoUpload||t.autoUpload)&&!1!==t.autoUpload&&t.submit()}).fail(function(){t.files.error&&t.context.each(function(e){var n=t.files[e].error;n&&i(this).find(".error").text(n)})})},send:function(e,t){if(e.isDefaultPrevented())return!1;var n=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload");return t.context&&t.dataType&&"iframe"===t.dataType.substr(0,6)&&t.context.find(".progress").addClass(!i.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),n._trigger("sent",null,t)},done:function(e,t){if(e.isDefaultPrevented())return!1;var n,r,s=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload"),o=t.getFilesFromResponse||s.options.getFilesFromResponse,a=o(t);t.context?t.context.each(function(e){var o=a[e]||{error:"Empty file upload result"};r=s._addFinishedDeferreds(),s._transition(i(this)).done(function(){var e=i(this);n=s._renderDownload([o]).replaceAll(e),s._forceReflow(n),s._transition(n).done(function(){t.context=i(this),s._trigger("completed",null,t),s._trigger("finished",null,t),r.resolve()})})}):(n=s._renderDownload(a)[s.options.prependFiles?"prependTo":"appendTo"](s.options.filesContainer),s._forceReflow(n),r=s._addFinishedDeferreds(),s._transition(n).done(function(){t.context=i(this),s._trigger("completed",null,t),s._trigger("finished",null,t),r.resolve()}))},fail:function(e,t){if(e.isDefaultPrevented())return!1;var n,r,s=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload");t.context?t.context.each(function(e){if("abort"!==t.errorThrown){var o=t.files[e];o.error=o.error||t.errorThrown||!0,r=s._addFinishedDeferreds(),s._transition(i(this)).done(function(){var e=i(this);n=s._renderDownload([o]).replaceAll(e),s._forceReflow(n),s._transition(n).done(function(){t.context=i(this),s._trigger("failed",null,t),s._trigger("finished",null,t),r.resolve()})})}else r=s._addFinishedDeferreds(),s._transition(i(this)).done(function(){i(this).remove(),s._trigger("failed",null,t),s._trigger("finished",null,t),r.resolve()})}):"abort"!==t.errorThrown?(t.context=s._renderUpload(t.files)[s.options.prependFiles?"prependTo":"appendTo"](s.options.filesContainer).data("data",t),s._forceReflow(t.context),r=s._addFinishedDeferreds(),s._transition(t.context).done(function(){t.context=i(this),s._trigger("failed",null,t),s._trigger("finished",null,t),r.resolve()})):(s._trigger("failed",null,t),s._trigger("finished",null,t),s._addFinishedDeferreds().resolve())},progress:function(e,t){if(e.isDefaultPrevented())return!1;var n=Math.floor(t.loaded/t.total*100);t.context&&t.context.each(function(){i(this).find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")})},progressall:function(e,t){var n=i(this),r=Math.floor(t.loaded/t.total*100),s=n.find(".fileupload-progress"),o=s.find(".progress-extended");o.length&&o.html((n.data("blueimp-fileuploadui")||n.data("fileupload"))._renderExtendedProgress(t)),s.find(".progress").attr("aria-valuenow",r).children().first().css("width",r+"%")},start:function(e){if(e.isDefaultPrevented())return!1;var t=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload");t._resetFinishedDeferreds(),t._transition(i(this).find(".fileupload-progress")).done(function(){t._trigger("started",null)})},stop:function(e){if(e.isDefaultPrevented())return!1;var t=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload"),n=t._addFinishedDeferreds();i.when.apply(i,t._getFinishedDeferreds()).done(function(){t._trigger("stopped",null)}),t._transition(i(this).find(".fileupload-progress")).done(function(){i(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),i(this).find(".progress-extended").html("&nbsp;"),n.resolve()})},processstart:function(e){if(e.isDefaultPrevented())return!1;i(this).addClass("fileupload-processing")},processstop:function(e){if(e.isDefaultPrevented())return!1;i(this).removeClass("fileupload-processing")},destroy:function(e,t){var n=i(this).data("blueimp-fileuploadui")||i(this).data("fileupload"),r=function(){n._transition(t.context).done(function(){i(this).remove(),n._trigger("destroyed",null,t)})};t.url?(t.dataType=t.dataType||n.options.dataType,i.ajax(t).done(r).fail(function(){n._trigger("destroyfailed",null,t)})):r()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){return e||(e=i.Deferred()),this._finishedUploads.push(e),e},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var e=i(this),t=e.prop("href"),n=e.prop("download"),r="application/octet-stream";e.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[r,n,t].join(":"))}catch(e){}})},_formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=Math.floor(e/86400);return(i=i?i+"d ":"")+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(e,t){if(!e)return i();var n=e({files:t,formatFileSize:this._formatFileSize,options:this.options});return n instanceof i?n:i(this.options.templatesContainer).html(n).children()},_renderPreviews:function(e){e.context.find(".preview").each(function(t,n){i(n).append(e.files[t].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var t=i(e.currentTarget),n=t.closest(".template-upload"),r=n.data("data");t.prop("disabled",!0),r&&r.submit&&r.submit()},_cancelHandler:function(e){e.preventDefault();var t=i(e.currentTarget).closest(".template-upload,.template-download"),n=t.data("data")||{};n.context=n.context||t,n.abort?n.abort():(n.errorThrown="abort",this._trigger("fail",null,n))},_deleteHandler:function(e){e.preventDefault();var t=i(e.currentTarget);this._trigger("destroy",null,i.extend({context:t.closest(".template-download"),type:"DELETE"},t.data()))},_forceReflow:function(e){return i.support.transition&&e.length&&e[0].offsetWidth},_transition:function(e){var t=i.Deferred();return i.support.transition&&e.hasClass("fade")&&e.is(":visible")?e.bind(i.support.transition.end,function(n){n.target===e[0]&&(e.unbind(i.support.transition.end),t.resolveWith(e))}).toggleClass("in"):(e.toggleClass("in"),t.resolveWith(e)),t},_initButtonBarEventHandlers:function(){var e=this.element.find(".fileupload-buttonbar"),t=this.options.filesContainer;this._on(e.find(".start"),{click:function(e){e.preventDefault(),t.find(".start").click()}}),this._on(e.find(".cancel"),{click:function(e){e.preventDefault(),t.find(".cancel").click()}}),this._on(e.find(".delete"),{click:function(i){i.preventDefault(),t.find(".toggle:checked").closest(".template-download").find(".delete").click(),e.find(".toggle").prop("checked",!1)}}),this._on(e.find(".toggle"),{change:function(e){t.find(".toggle").prop("checked",i(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),n&&(e.uploadTemplateId&&(e.uploadTemplate=n(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=n(e.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof i||(e.filesContainer=i(e.filesContainer))},_initSpecialOptions:function(){this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._processing=0,this._processingQueue=i.Deferred().resolveWith(this).promise(),this._initSpecialOptions(),this._initEventHandlers(),i(this.element).fileupload(this.options),this._resetFinishedDeferreds(),i.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}}),i}),e("skylark-blueimp-uploader/addons/image",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-utils-imagex","skylark-jquery","skylark-jqueryui/widget","../fileupload-ui"],function(e,t,i,n){"use strict";return n.blueimp.fileuploadui.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"}),n.widget("blueimp.fileuploadui",n.blueimp.fileuploadui,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(e,t){if(t.disabled)return e;var r=this,s=e.files[e.index],o=n.Deferred();return"number"===n.type(t.maxFileSize)&&s.size>t.maxFileSize||t.fileTypes&&!t.fileTypes.test(s.type)||!i.loadFile(s,function(t){t.src&&(e.img=t),o.resolveWith(r,[e])},t)?e:o.promise()},resizeImage:function(e,t){if(t.disabled||!e.canvas&&!e.img)return e;t=n.extend({canvas:!0},t);var r,s=this,o=n.Deferred(),a=t.canvas&&e.canvas||e.img,l=function(i){i&&(i.width!==a.width||i.height!==a.height||t.forceResize)&&(e[i.getContext?"canvas":"img"]=i),e.preview=i,o.resolveWith(s,[e])};if(e.exif){if(!0===t.orientation&&(t.orientation=e.exif.get("Orientation")),t.thumbnail&&(r=e.exif.get("Thumbnail")))return i.loadFile(r,l,t),o.promise();e.orientation?delete t.orientation:e.orientation=t.orientation}return a?(l(i.scale(a,t)),o.promise()):e},saveImage:function(e,t){if(!e.canvas||t.disabled)return e;var i=this,r=e.files[e.index],s=n.Deferred();return e.canvas.toBlob?(e.canvas.toBlob(function(t){t.name||(r.type===t.type?t.name=r.name:r.name&&(t.name=r.name.replace(/\..+$/,"."+t.type.substr(6)))),r.type!==t.type&&delete e.imageHead,e.files[e.index]=t,s.resolveWith(i,[e])},t.type||r.type,t.quality),s.promise()):e},loadImageMetaData:function(e,t){if(t.disabled)return e;var r=this,s=n.Deferred();return i.meta.parseMetaData(e.files[e.index],function(t){n.extend(e,t),s.resolveWith(r,[e,"aaa"])},t),s.promise()},saveImageMetaData:function(e,t){if(!(e.imageHead&&e.canvas&&e.canvas.toBlob)||t.disabled)return e;var i=e.files[e.index],n=new Blob([e.imageHead,this._blobSlice.call(i,20)],{type:i.type});return n.name=i.name,e.files[e.index]=n,e},setImage:function(e,t){return e.preview&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.preview),e},deleteImageReferences:function(e,t){return t.disabled||(delete e.img,delete e.canvas,delete e.preview,delete e.imageHead),e}}}),n}),e("skylark-blueimp-uploader/addons/audio",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-utils-imagex","skylark-jquery","skylark-jqueryui/widget","../fileupload-ui"],function(e,t,i,n){"use strict";return n.blueimp.fileuploadui.prototype.options.processQueue.unshift({action:"loadAudio",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableAudioPreview"},{action:"setAudio",name:"@audioPreviewName",disabled:"@disableAudioPreview"}),n.widget("blueimp.fileuploadui",n.blueimp.fileuploadui,{options:{loadAudioFileTypes:/^audio\/.*$/},_audioElement:document.createElement("audio"),processActions:{loadAudio:function(e,t){if(t.disabled)return e;var r,s,o=e.files[e.index];return this._audioElement.canPlayType&&this._audioElement.canPlayType(o.type)&&("number"!==n.type(t.maxFileSize)||o.size<=t.maxFileSize)&&(!t.fileTypes||t.fileTypes.test(o.type))&&(r=i.createObjectURL(o))?((s=this._audioElement.cloneNode(!1)).src=r,s.controls=!0,e.audio=s,e):e},setAudio:function(e,t){return e.audio&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.audio),e}}}),n}),e("skylark-blueimp-uploader/addons/video",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-utils-imagex","skylark-jquery","skylark-jqueryui/widget","../fileupload-ui"],function(e,t,i,n){"use strict";return n.blueimp.fileuploadui.prototype.options.processQueue.unshift({action:"loadVideo",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableVideoPreview"},{action:"setVideo",name:"@videoPreviewName",disabled:"@disableVideoPreview"}),n.widget("blueimp.fileuploadui",n.blueimp.fileuploadui,{options:{loadVideoFileTypes:/^video\/.*$/},_videoElement:document.createElement("video"),processActions:{loadVideo:function(e,t){if(t.disabled)return e;var i,r,s=e.files[e.index];return this._videoElement.canPlayType&&this._videoElement.canPlayType(s.type)&&("number"!==n.type(t.maxFileSize)||s.size<=t.maxFileSize)&&(!t.fileTypes||t.fileTypes.test(s.type))&&(i=loadImage.createObjectURL(s))?((r=this._videoElement.cloneNode(!1)).src=i,r.controls=!0,e.video=r,e):e},setVideo:function(e,t){return e.video&&!t.disabled&&(e.files[e.index][t.name||"preview"]=e.video),e}}}),n}),e("skylark-blueimp-uploader/addons/validate",["skylark-langx/langx","skylark-utils-dom/eventer","skylark-jquery","skylark-jqueryui/widget","../fileupload-ui"],function(e,t,i){"use strict";return i.blueimp.fileuploadui.prototype.options.processQueue.push({action:"validate",always:!0,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"}),i.widget("blueimp.fileuploadui",i.blueimp.fileuploadui,{options:{getNumberOfFiles:i.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(e,t){if(t.disabled)return e;var n,r=i.Deferred(),s=this.options,o=e.files[e.index];return(t.minFileSize||t.maxFileSize)&&(n=o.size),"number"===i.type(t.maxNumberOfFiles)&&(s.getNumberOfFiles()||0)+e.files.length>t.maxNumberOfFiles?o.error=s.i18n("maxNumberOfFiles"):!t.acceptFileTypes||t.acceptFileTypes.test(o.type)||t.acceptFileTypes.test(o.name)?n>t.maxFileSize?o.error=s.i18n("maxFileSize"):"number"===i.type(n)&&n<t.minFileSize?o.error=s.i18n("minFileSize"):delete o.error:o.error=s.i18n("acceptFileTypes"),o.error||e.files.error?(e.files.error=!0,r.rejectWith(this,[e])):r.resolveWith(this,[e]),r.promise()}}}),i}),e("skylark-blueimp-uploader/main",["./fileupload-ui","./addons/image","./addons/audio","./addons/video","./addons/validate"],function(e){return e}),e("skylark-blueimp-uploader",["skylark-blueimp-uploader/main"],function(e){return e})}(i),!r){var a=n("skylark-langx/skylark");s?module.exports=a:t.skylarkjs=a}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-blueimp-uploader.js.map
