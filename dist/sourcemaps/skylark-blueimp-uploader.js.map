{"version":3,"sources":["skylark-blueimp-uploader.js"],"names":["define","langx","tmpl","str","data","f","test","Function","arg","helper","replace","regexp","func","cache","load","id","document","getElementById","innerHTML","s","p1","p2","p3","p4","p5","\n","\r","\t"," ","encReg","encMap","<",">","&","\"","'","encode","c","eventer","filer","$","Deferred","FileUploader","Evented","inherit","options","dropZone","pasteZone","picker","undefined","paramName","singleFileUploads","limitMultiFileUploads","limitMultiFileUploadSize","limitMultiFileUploadSizeOverhead","sequentialUploads","limitConcurrentUploads","postMessage","multipart","maxChunkSize","uploadedBytes","recalculateProgress","progressInterval","bitrateInterval","autoUpload","messages","i18n","message","context","this","toString","each","key","value","formData","form","serializeArray","add","e","isDefaultPrevented","fileupload","option","process","done","submit","processData","contentType","_specialOptions","_BitrateTimer","timestamp","Date","now","getTime","loaded","bitrate","getBitrate","interval","timeDiff","_getTotal","files","total","index","file","size","_initProgressObject","obj","progress","_progress","extend","_initResponseObject","prop","_response","hasOwnProperty","_onProgress","lengthComputable","_time","Math","floor","chunkSize","_bitrateTimer","_trigger","create","delegatedEvent","_getParamName","isArray","_getDeferredState","deferred","state","isResolved","isRejected","_enhancePromise","promise","success","error","fail","complete","always","_getXHRPromise","resolveOrReject","args","dfd","resolveWith","rejectWith","abort","_addConvenienceMethods","that","getPromise","resolveFunc","rejectFunc","_processQueue","pipe","errorThrown","arguments","jqXHR","_onSend","processing","response","_beforeSend","_active","_onDone","result","textStatus","_onFail","type","event","proxy","trigger","_onAlways","jqXHRorResult","jqXHRorError","_sending","url","dataType","xhrFields","upload","_onAdd","paramNameSet","paramNameSlice","fileSet","i","filesLength","length","limit","limitSize","overhead","batchSize","j","push","slice","originalFiles","element","newData","_initEventHandlers","dropzone","dropped","pastezone","pasted","multiple","picked","_destroyEventHandlers","_setOption","reinit","inArray","_super","_initSpecialOptions","_getRegExp","parts","split","modifiers","pop","shift","RegExp","join","_isRegExpOption","_construct","elm","_elm","mixin","_slots","_sequence","active","disabled","makeArray","send","fuInst","on","evt","typ","isFunction","call","uploader","widget","processActions","_processFile","originalData","skylark","funcs","map","processQueue","setting","action","async","waterful","_transformProcessQueue","settings","prefix","charAt","toUpperCase","_processing","opts","_processingQueue","uploadTemplateId","downloadTemplateId","filesContainer","prependFiles","getNumberOfFiles","children","not","getFilesFromResponse","$this","_renderUpload","addClass","_forceReflow","_transition","fileuploadui","find","text","_formatFileSize","removeClass","_renderPreviews","substr","support","transition","attr","first","css","template","_addFinishedDeferreds","node","_renderDownload","replaceAll","resolve","remove","progressall","globalProgressNode","extendedProgressNode","html","_renderExtendedProgress","start","_resetFinishedDeferreds","stop","when","apply","_getFinishedDeferreds","processstart","processstop","destroy","removeNode","ajax","_finishedUploads","_enableDragToDesktop","link","name","bind","originalEvent","dataTransfer","setData","ignore","bytes","toFixed","_formatBitrate","bits","_formatTime","seconds","date","days","getUTCHours","getUTCMinutes","getUTCSeconds","_formatPercentage","floatValue","_renderTemplate","formatFileSize","templatesContainer","append","preview","uploadTemplate","downloadTemplate","end","_startHandler","preventDefault","button","currentTarget","closest","_cancelHandler","_deleteHandler","offsetWidth","hasClass","is","target","unbind","toggleClass","_initButtonBarEventHandlers","fileUploadButtonBar","filesList","_on","click","change","_destroyButtonBarEventHandlers","_off","click .start","click .cancel","click .delete","_enableFileInputButton","parent","_disableFileInputButton","_initTemplates","createElement","_initFilesContainer","_create","_uploader","fileInput","enable","wasDisabled","disable","imagex","blueimp","prototype","unshift","disableImageHead","disableExif","disableExifThumbnail","disableExifSub","disableExifGps","fileTypes","maxFileSize","noRevoke","maxWidth","maxHeight","minWidth","minHeight","crop","orientation","forceResize","quality","thumbnail","canvas","loadImageFileTypes","loadImageMaxFileSize","imageMaxWidth","imageMaxHeight","imageOrientation","imageCrop","disableImageResize","previewMaxWidth","previewMaxHeight","previewOrientation","previewThumbnail","previewCrop","previewCanvas","loadImage","loadFile","img","src","resizeImage","newImg","width","height","getContext","exif","get","scale","saveImage","toBlob","blob","imageHead","loadImageMetaData","meta","parseMetaData","saveImageMetaData","Blob","_blobSlice","setImage","deleteImageReferences","loadAudioFileTypes","_audioElement","loadAudio","audio","canPlayType","createObjectURL","cloneNode","controls","setAudio","loadVideoFileTypes","_videoElement","loadVideo","video","setVideo","acceptFileTypes","minFileSize","maxNumberOfFiles","noop","validate","fileSize","main"],"mappings":"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","file":"../skylark-blueimp-uploader.js","sourcesContent":["define('skylark-blueimp-uploader/tmpl',[\r\n    \"skylark-langx/langx\"\r\n],function (langx) {\r\n\r\n  'use strict'\r\n\r\n  var tmpl = function (str, data) {\r\n    var f = !/[^\\w\\-.:]/.test(str)\r\n      ? (tmpl.cache[str] = tmpl.cache[str] || tmpl(tmpl.load(str)))\r\n      : new Function( // eslint-disable-line no-new-func\r\n        tmpl.arg + ',tmpl',\r\n        'var _e=tmpl.encode' +\r\n            tmpl.helper +\r\n            \",_s='\" +\r\n            str.replace(tmpl.regexp, tmpl.func) +\r\n            \"';return _s;\"\r\n      )\r\n    return data\r\n      ? f(data, tmpl)\r\n      : function (data) {\r\n        return f(data, tmpl)\r\n      }\r\n  }\r\n  tmpl.cache = {}\r\n  tmpl.load = function (id) {\r\n    return document.getElementById(id).innerHTML\r\n  }\r\n  tmpl.regexp = /([\\s'\\\\])(?!(?:[^{]|\\{(?!%))*%\\})|(?:\\{%(=|#)([\\s\\S]+?)%\\})|(\\{%)|(%\\})/g\r\n  tmpl.func = function (s, p1, p2, p3, p4, p5) {\r\n    if (p1) {\r\n      // whitespace, quote and backspace in HTML context\r\n      return (\r\n        {\r\n          '\\n': '\\\\n',\r\n          '\\r': '\\\\r',\r\n          '\\t': '\\\\t',\r\n          ' ': ' '\r\n        }[p1] || '\\\\' + p1\r\n      )\r\n    }\r\n    if (p2) {\r\n      // interpolation: {%=prop%}, or unescaped: {%#prop%}\r\n      if (p2 === '=') {\r\n        return \"'+_e(\" + p3 + \")+'\"\r\n      }\r\n      return \"'+(\" + p3 + \"==null?'':\" + p3 + \")+'\"\r\n    }\r\n    if (p4) {\r\n      // evaluation start tag: {%\r\n      return \"';\"\r\n    }\r\n    if (p5) {\r\n      // evaluation end tag: %}\r\n      return \"_s+='\"\r\n    }\r\n  }\r\n  tmpl.encReg = /[<>&\"'\\x00]/g // eslint-disable-line no-control-regex\r\n  tmpl.encMap = {\r\n    '<': '&lt;',\r\n    '>': '&gt;',\r\n    '&': '&amp;',\r\n    '\"': '&quot;',\r\n    \"'\": '&#39;'\r\n  }\r\n  tmpl.encode = function (s) {\r\n    return (s == null ? '' : '' + s).replace(tmpl.encReg, function (c) {\r\n      return tmpl.encMap[c] || ''\r\n    })\r\n  }\r\n  tmpl.arg = 'o'\r\n  tmpl.helper =\r\n    \",print=function(s,e){_s+=e?(s==null?'':s):_e(s);}\" +\r\n    ',include=function(s,d){_s+=tmpl(s,d);}';\r\n\r\n\r\n  return tmpl;\r\n\r\n});\ndefine('skylark-blueimp-uploader/fileupload',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-utils-filer\",\r\n    'skylark-jquery'\r\n],function (langx,eventer,filer,$) {\r\n    'use strict';\r\n\r\n    var Deferred = langx.Deferred;\r\n\r\n\r\n    // The fileupload widget listens for change events on file input fields defined\r\n    // via fileInput setting and paste or drop events of the given dropZone.\r\n    // In addition to the default jQuery Widget methods, the fileupload widget\r\n    // exposes the \"add\" and \"send\" methods, to add or directly send files using\r\n    // the fileupload API.\r\n    // By default, files added via file input selection, paste, drag & drop or\r\n    // \"add\" method are uploaded immediately, but it is possible to override\r\n    // the \"add\" callback option to queue file uploads.\r\n\r\n    var FileUploader = langx.Evented.inherit( {\r\n\r\n        options: {\r\n            // The drop target element(s), by the default the complete document.\r\n            // Set to null to disable drag & drop support:\r\n            dropZone: $(document),\r\n\r\n            // The paste target element(s), by the default the complete document.\r\n            // Set to null to disable paste support:\r\n            pasteZone: $(document),\r\n\r\n            // The file input field(s), that are listened to for change events.\r\n            // If undefined, it is set to the file input fields inside\r\n            // of the widget element on plugin initialization.\r\n            // Set to null to disable the change listener.\r\n            picker: undefined,\r\n\r\n\r\n            // The parameter name for the file form data (the request argument name).\r\n            // If undefined or empty, the name property of the file input field is\r\n            // used, or \"files[]\" if the file input name property is also empty,\r\n            // can be a string or an array of strings:\r\n            paramName: undefined,\r\n            \r\n            // By default, each file of a selection is uploaded using an individual\r\n            // request for XHR type uploads. Set to false to upload file\r\n            // selections in one request each:\r\n            singleFileUploads: true,\r\n            \r\n            // To limit the number of files uploaded with one XHR request,\r\n            // set the following option to an integer greater than 0:\r\n            limitMultiFileUploads: undefined,\r\n            \r\n            // The following option limits the number of files uploaded with one\r\n            // XHR request to keep the request size under or equal to the defined\r\n            // limit in bytes:\r\n            limitMultiFileUploadSize: undefined,\r\n\r\n            // Multipart file uploads add a number of bytes to each uploaded file,\r\n            // therefore the following option adds an overhead for each file used\r\n            // in the limitMultiFileUploadSize configuration:\r\n            limitMultiFileUploadSizeOverhead: 512,\r\n\r\n            // Set the following option to true to issue all file upload requests\r\n            // in a sequential order:\r\n            sequentialUploads: false,\r\n            \r\n            // To limit the number of concurrent uploads,\r\n            // set the following option to an integer greater than 0:\r\n            limitConcurrentUploads: undefined,\r\n\r\n            // Set the following option to the location of a postMessage window,\r\n            // to enable postMessage transport uploads:\r\n            postMessage: undefined,\r\n \r\n            // By default, XHR file uploads are sent as multipart/form-data.\r\n            // The iframe transport is always using multipart/form-data.\r\n            // Set to false to enable non-multipart XHR uploads:\r\n            multipart: true,\r\n \r\n            // To upload large files in smaller chunks, set the following option\r\n            // to a preferred maximum chunk size. If set to 0, null or undefined,\r\n            // or the browser does not support the required Blob API, files will\r\n            // be uploaded as a whole.\r\n            maxChunkSize: undefined,\r\n \r\n            // When a non-multipart upload or a chunked multipart upload has been\r\n            // aborted, this option can be used to resume the upload by setting\r\n            // it to the size of the already uploaded bytes. This option is most\r\n            // useful when modifying the options object inside of the \"add\" or\r\n            // \"send\" callbacks, as the options are cloned for each file upload.\r\n            uploadedBytes: undefined,\r\n \r\n            // By default, failed (abort or error) file uploads are removed from the\r\n            // global progress calculation. Set the following option to false to\r\n            // prevent recalculating the global progress data:\r\n            recalculateProgress: true,\r\n \r\n            // Interval in milliseconds to calculate and trigger progress events:\r\n            progressInterval: 100,\r\n \r\n            // Interval in milliseconds to calculate progress bitrate:\r\n            bitrateInterval: 500,\r\n \r\n            // By default, uploads are started automatically when adding files:\r\n            autoUpload: false,\r\n\r\n            // Error and info messages:\r\n            messages: {\r\n                uploadedBytes: 'Uploaded bytes exceed file size'\r\n            },\r\n\r\n            // Translation function, gets the message key to be translated\r\n            // and an object with context specific data as arguments:\r\n            i18n: function (message, context) {\r\n                message = this.messages[message] || message.toString();\r\n                if (context) {\r\n                    langx.each(context, function (key, value) {\r\n                        message = message.replace('{' + key + '}', value);\r\n                    });\r\n                }\r\n                return message;\r\n            },\r\n\r\n            // Additional form data to be sent along with the file uploads can be set\r\n            // using this option, which accepts an array of objects with name and\r\n            // value properties, a function returning such an array, a FormData\r\n            // object (for XHR file uploads), or a simple object.\r\n            // The form of the first fileInput is given as parameter to the function:\r\n            formData: function (form) {\r\n                return form.serializeArray();\r\n            },\r\n\r\n            // The add callback is invoked as soon as files are added to the fileupload\r\n            // widget (via file input selection, drag & drop, paste or add API call).\r\n            // If the singleFileUploads option is enabled, this callback will be\r\n            // called once for each file in the selection for XHR file uploads, else\r\n            // once for each file selection.\r\n            //\r\n            // The upload starts when the submit method is invoked on the data parameter.\r\n            // The data object contains a files property holding the added files\r\n            // and allows you to override plugin options as well as define ajax settings.\r\n            //\r\n            // Listeners for this callback can also be bound the following way:\r\n            // .bind('fileuploadadd', func);\r\n            //\r\n            // data.submit() returns a Promise object and allows to attach additional\r\n            // handlers using jQuery's Deferred callbacks:\r\n            // data.submit().done(func).fail(func).always(func);\r\n            add: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                if (data.autoUpload || (data.autoUpload !== false && $(this).fileupload(\"instance\").option('autoUpload') )) {\r\n                    data.process().done(function () {\r\n                        data.submit();\r\n                    });\r\n                }\r\n            },\r\n\r\n            // Other callbacks:\r\n\r\n            // Callback for the submit event of each file upload:\r\n            // submit: function (e, data) {}, // .bind('fileuploadsubmit', func);\r\n\r\n            // Callback for the start of each file upload request:\r\n            // send: function (e, data) {}, // .bind('fileuploadsend', func);\r\n\r\n            // Callback for successful uploads:\r\n            // done: function (e, data) {}, // .bind('fileuploaddone', func);\r\n\r\n            // Callback for failed (abort or error) uploads:\r\n            // fail: function (e, data) {}, // .bind('fileuploadfail', func);\r\n\r\n            // Callback for completed (success, abort or error) requests:\r\n            // always: function (e, data) {}, // .bind('fileuploadalways', func);\r\n\r\n            // Callback for upload progress events:\r\n            // progress: function (e, data) {}, // .bind('fileuploadprogress', func);\r\n\r\n            // Callback for global upload progress events:\r\n            // progressall: function (e, data) {}, // .bind('fileuploadprogressall', func);\r\n\r\n            // Callback for uploads start, equivalent to the global ajaxStart event:\r\n            // start: function (e) {}, // .bind('fileuploadstart', func);\r\n\r\n            // Callback for uploads stop, equivalent to the global ajaxStop event:\r\n            // stop: function (e) {}, // .bind('fileuploadstop', func);\r\n\r\n            // Callback for change events of the fileInput(s):\r\n            // change: function (e, data) {}, // .bind('fileuploadchange', func);\r\n\r\n            // Callback for paste events to the pasteZone(s):\r\n            // paste: function (e, data) {}, // .bind('fileuploadpaste', func);\r\n\r\n            // Callback for drop events of the dropZone(s):\r\n            // drop: function (e, data) {}, // .bind('fileuploaddrop', func);\r\n\r\n            // Callback for dragover events of the dropZone(s):\r\n            // dragover: function (e) {}, // .bind('fileuploaddragover', func);\r\n\r\n            // Callback for the start of each chunk upload request:\r\n            // chunksend: function (e, data) {}, // .bind('fileuploadchunksend', func);\r\n\r\n            // Callback for successful chunk uploads:\r\n            // chunkdone: function (e, data) {}, // .bind('fileuploadchunkdone', func);\r\n\r\n            // Callback for failed (abort or error) chunk uploads:\r\n            // chunkfail: function (e, data) {}, // .bind('fileuploadchunkfail', func);\r\n\r\n            // Callback for completed (success, abort or error) chunk upload requests:\r\n            // chunkalways: function (e, data) {}, // .bind('fileuploadchunkalways', func);\r\n\r\n            // The plugin options are used as settings object for the ajax calls.\r\n            // The following are jQuery ajax settings required for the file uploads:\r\n            processData: false,\r\n            contentType: false,\r\n            cache: false\r\n        },\r\n\r\n        // A list of options that require reinitializing event listeners and/or\r\n        // special initialization code:\r\n        _specialOptions: [\r\n            'picker',\r\n            'dropZone',\r\n            'pasteZone',\r\n            'multipart',\r\n            'filesContainer',\r\n            'uploadTemplateId',\r\n            'downloadTemplateId'            \r\n        ],\r\n\r\n        _BitrateTimer: function () {\r\n            this.timestamp = ((Date.now) ? Date.now() : (new Date()).getTime());\r\n            this.loaded = 0;\r\n            this.bitrate = 0;\r\n            this.getBitrate = function (now, loaded, interval) {\r\n                var timeDiff = now - this.timestamp;\r\n                if (!this.bitrate || !interval || timeDiff > interval) {\r\n                    this.bitrate = (loaded - this.loaded) * (1000 / timeDiff) * 8;\r\n                    this.loaded = loaded;\r\n                    this.timestamp = now;\r\n                }\r\n                return this.bitrate;\r\n            };\r\n        },\r\n\r\n        _getTotal: function (files) {\r\n            var total = 0;\r\n            langx.each(files, function (index, file) {\r\n                total += file.size || 1;\r\n            });\r\n            return total;\r\n        },\r\n\r\n        _initProgressObject: function (obj) {\r\n            var progress = {\r\n                loaded: 0,\r\n                total: 0,\r\n                bitrate: 0\r\n            };\r\n            if (obj._progress) {\r\n                langx.extend(obj._progress, progress);\r\n            } else {\r\n                obj._progress = progress;\r\n            }\r\n        },\r\n\r\n        _initResponseObject: function (obj) {\r\n            var prop;\r\n            if (obj._response) {\r\n                for (prop in obj._response) {\r\n                    if (obj._response.hasOwnProperty(prop)) {\r\n                        delete obj._response[prop];\r\n                    }\r\n                }\r\n            } else {\r\n                obj._response = {};\r\n            }\r\n        },\r\n\r\n        _onProgress: function (e, data) {\r\n            if (e.lengthComputable) {\r\n                var now = ((Date.now) ? Date.now() : (new Date()).getTime()),\r\n                    loaded;\r\n                if (data._time && data.progressInterval &&\r\n                        (now - data._time < data.progressInterval) &&\r\n                        e.loaded !== e.total) {\r\n                    return;\r\n                }\r\n                data._time = now;\r\n                loaded = Math.floor(\r\n                    e.loaded / e.total * (data.chunkSize || data._progress.total)\r\n                ) + (data.uploadedBytes || 0);\r\n                // Add the difference from the previously loaded state\r\n                // to the global loaded counter:\r\n                this._progress.loaded += (loaded - data._progress.loaded);\r\n                this._progress.bitrate = this._bitrateTimer.getBitrate(\r\n                    now,\r\n                    this._progress.loaded,\r\n                    data.bitrateInterval\r\n                );\r\n                data._progress.loaded = data.loaded = loaded;\r\n                data._progress.bitrate = data.bitrate = data._bitrateTimer.getBitrate(\r\n                    now,\r\n                    loaded,\r\n                    data.bitrateInterval\r\n                );\r\n                // Trigger a custom progress event with a total data property set\r\n                // to the file size(s) of the current upload and a loaded data\r\n                // property calculated accordingly:\r\n                this._trigger(\r\n                    'progress',\r\n                    eventer.create('progress', {delegatedEvent: e}),\r\n                    data\r\n                );\r\n                // Trigger a global progress event for all current file uploads,\r\n                // including ajax calls queued for sequential file uploads:\r\n                this._trigger(\r\n                    'progressall',\r\n                    eventer.create('progressall', {delegatedEvent: e}),\r\n                    this._progress\r\n                );\r\n            }\r\n        },\r\n\r\n        _getParamName: function (options) {\r\n            var picker = $(options.picker),\r\n                paramName = options.paramName;\r\n            //if (!paramName) {\r\n            //    paramName = [fileInput.prop('name') || 'files[]'];\r\n            // } else if (!langx.isArray(paramName)) {\r\n\r\n            if (!langx.isArray(paramName)) {\r\n                paramName = [paramName];\r\n            }\r\n            return paramName;\r\n        },\r\n\r\n\r\n        // jQuery 1.6 doesn't provide .state(),\r\n        // while jQuery 1.8+ removed .isRejected() and .isResolved():\r\n        _getDeferredState: function (deferred) {\r\n            if (deferred.state) {\r\n                return deferred.state();\r\n            }\r\n            if (deferred.isResolved()) {\r\n                return 'resolved';\r\n            }\r\n            if (deferred.isRejected()) {\r\n                return 'rejected';\r\n            }\r\n            return 'pending';\r\n        },\r\n\r\n        // Maps jqXHR callbacks to the equivalent\r\n        // methods of the given Promise object:\r\n        _enhancePromise: function (promise) {\r\n            promise.success = promise.done;\r\n            promise.error = promise.fail;\r\n            promise.complete = promise.always;\r\n            return promise;\r\n        },\r\n\r\n        // Creates and returns a Promise object enhanced with\r\n        // the jqXHR methods abort, success, error and complete:\r\n        _getXHRPromise: function (resolveOrReject, context, args) {\r\n            var dfd = new Deferred(),\r\n                promise = dfd.promise;\r\n            context = context || this.options.context || promise;\r\n            if (resolveOrReject === true) {\r\n                dfd.resolveWith(context, args);\r\n            } else if (resolveOrReject === false) {\r\n                dfd.rejectWith(context, args);\r\n            }\r\n            promise.abort = dfd.promise;\r\n            return this._enhancePromise(promise);\r\n        },\r\n\r\n        // Adds convenience methods to the data callback argument:\r\n        _addConvenienceMethods: function (e, data) {\r\n            var that = this,\r\n                getPromise = function (args) {\r\n                    return new Deferred().resolveWith(that, args).promise;\r\n                };\r\n            data.process = function (resolveFunc, rejectFunc) {\r\n                if (resolveFunc || rejectFunc) {\r\n                    data._processQueue = this._processQueue =\r\n                        (this._processQueue || getPromise([this])).pipe(\r\n                            function () {\r\n                                if (data.errorThrown) {\r\n                                    return new Deferred()\r\n                                        .rejectWith(that, [data]).promise;\r\n                                }\r\n                                return getPromise(arguments);\r\n                            }\r\n                        ).pipe(resolveFunc, rejectFunc);\r\n                }\r\n                return this._processQueue || getPromise([this]);\r\n            };\r\n            data.submit = function () {\r\n                if (this.state() !== 'pending') {\r\n                    data.jqXHR = this.jqXHR =\r\n                        (that._trigger(\r\n                            'submit',\r\n                            eventer.create('submit', {delegatedEvent: e}),\r\n                            this\r\n                        ) !== false) && that._onSend(e, this);\r\n                }\r\n                return this.jqXHR || that._getXHRPromise();\r\n            };\r\n            data.abort = function () {\r\n                if (this.jqXHR) {\r\n                    return this.jqXHR.abort();\r\n                }\r\n                this.errorThrown = 'abort';\r\n                that._trigger('fail', null, this);\r\n                return that._getXHRPromise(false);\r\n            };\r\n            data.state = function () {\r\n                if (this.jqXHR) {\r\n                    return that._getDeferredState(this.jqXHR);\r\n                }\r\n                if (this._processQueue) {\r\n                    return that._getDeferredState(this._processQueue);\r\n                }\r\n            };\r\n            data.processing = function () {\r\n                return !this.jqXHR && this._processQueue && that\r\n                    ._getDeferredState(this._processQueue) === 'pending';\r\n            };\r\n            data.progress = function () {\r\n                return this._progress;\r\n            };\r\n            data.response = function () {\r\n                return this._response;\r\n            };\r\n        },\r\n\r\n        _beforeSend: function (e, data) {\r\n            if (this._active === 0) {\r\n                // the start callback is triggered when an upload starts\r\n                // and no other uploads are currently running,\r\n                // equivalent to the global ajaxStart event:\r\n                this._trigger('start');\r\n                // Set timer for global bitrate progress calculation:\r\n                this._bitrateTimer = new this._BitrateTimer();\r\n                // Reset the global progress values:\r\n                this._progress.loaded = this._progress.total = 0;\r\n                this._progress.bitrate = 0;\r\n            }\r\n            // Make sure the container objects for the .response() and\r\n            // .progress() methods on the data object are available\r\n            // and reset to their initial state:\r\n            this._initResponseObject(data);\r\n            this._initProgressObject(data);\r\n            data._progress.loaded = data.loaded = data.uploadedBytes || 0;\r\n            data._progress.total = data.total = this._getTotal(data.files) || 1;\r\n            data._progress.bitrate = data.bitrate = 0;\r\n            this._active += 1;\r\n            // Initialize the global progress values:\r\n            this._progress.loaded += data.loaded;\r\n            this._progress.total += data.total;\r\n        },\r\n\r\n        _onDone: function (result, textStatus, jqXHR, options) {\r\n            var total = options._progress.total,\r\n                response = options._response;\r\n            if (options._progress.loaded < total) {\r\n                // Create a progress event if no final progress event\r\n                // with loaded equaling total has been triggered:\r\n                this._onProgress(eventer.create('progress', {\r\n                    lengthComputable: true,\r\n                    loaded: total,\r\n                    total: total\r\n                }), options);\r\n            }\r\n            response.result = options.result = result;\r\n            response.textStatus = options.textStatus = textStatus;\r\n            response.jqXHR = options.jqXHR = jqXHR;\r\n            this._trigger('done', null, options);\r\n        },\r\n\r\n        _onFail: function (jqXHR, textStatus, errorThrown, options) {\r\n            var response = options._response;\r\n            if (options.recalculateProgress) {\r\n                // Remove the failed (error or abort) file upload from\r\n                // the global progress calculation:\r\n                this._progress.loaded -= options._progress.loaded;\r\n                this._progress.total -= options._progress.total;\r\n            }\r\n            response.jqXHR = options.jqXHR = jqXHR;\r\n            response.textStatus = options.textStatus = textStatus;\r\n            response.errorThrown = options.errorThrown = errorThrown;\r\n            this._trigger('fail', null, options);\r\n        },\r\n\r\n        _trigger : function(type,event,data) {\r\n            var e = eventer.proxy(event);\r\n            e.type = type;\r\n            e.data =data;\r\n            return this.trigger(e,data);\r\n        },\r\n\r\n        _onAlways: function (jqXHRorResult, textStatus, jqXHRorError, options) {\r\n            // jqXHRorResult, textStatus and jqXHRorError are added to the\r\n            // options object via done and fail callbacks\r\n            this._trigger('always', null, options);\r\n        },\r\n\r\n        _onSend: function (e, data) {\r\n            if (!data.submit) {\r\n                this._addConvenienceMethods(e, data);\r\n            }\r\n            var that = this,\r\n                jqXHR,\r\n                aborted,\r\n                slot,\r\n                pipe,\r\n                send = function () {\r\n                    that._sending += 1;\r\n                    data.url = that.options.url;\r\n                    data.dataType = that.options.dataType;\r\n                    data.xhrFields = that.options.xhrFields;\r\n\r\n                    jqXHR = filer.upload(data);\r\n\r\n                    jqXHR.progress(function(e){\r\n                        //var oe = e.originalEvent;\r\n                        // Make sure the progress event properties get copied over:\r\n                        //e.lengthComputable = oe.lengthComputable;\r\n                        //e.loaded = oe.loaded;\r\n                        //e.total = oe.total;\r\n                        that._onProgress(e, jqXHR.options);\r\n\r\n                    }).done(function (result, textStatus) {\r\n                        that._onDone(result, textStatus, jqXHR, jqXHR.options);\r\n                    }).fail(function (e, textStatus) {\r\n                        that._onFail(jqXHR, textStatus,e, jqXHR.options);\r\n                    }).always(function () {\r\n                        that._sending -= 1;\r\n                        that._active -= 1;\r\n                        that._trigger('stop');\r\n                    });\r\n                    return jqXHR;\r\n                };\r\n            this._beforeSend(e, data);\r\n\r\n            return send();\r\n        },\r\n        _onAdd: function (e, data) {\r\n            var that = this,\r\n                result = true,\r\n                options = langx.extend({}, this.options, data),\r\n                files = data.files,\r\n                filesLength = files.length,\r\n                limit = options.limitMultiFileUploads,\r\n                limitSize = options.limitMultiFileUploadSize,\r\n                overhead = options.limitMultiFileUploadSizeOverhead,\r\n                batchSize = 0,\r\n                paramName = this._getParamName(options),\r\n                paramNameSet,\r\n                paramNameSlice,\r\n                fileSet,\r\n                i,\r\n                j = 0;\r\n            if (limitSize && (!filesLength || files[0].size === undefined)) {\r\n                limitSize = undefined;\r\n            }\r\n            if (!(options.singleFileUploads || limit || limitSize)) {\r\n                fileSet = [files];\r\n                paramNameSet = [paramName];\r\n            } else if (!(options.singleFileUploads || limitSize) && limit) {\r\n                fileSet = [];\r\n                paramNameSet = [];\r\n                for (i = 0; i < filesLength; i += limit) {\r\n                    fileSet.push(files.slice(i, i + limit));\r\n                    paramNameSlice = paramName.slice(i, i + limit);\r\n                    if (!paramNameSlice.length) {\r\n                        paramNameSlice = paramName;\r\n                    }\r\n                    paramNameSet.push(paramNameSlice);\r\n                }\r\n            } else if (!options.singleFileUploads && limitSize) {\r\n                fileSet = [];\r\n                paramNameSet = [];\r\n                for (i = 0; i < filesLength; i = i + 1) {\r\n                    batchSize += files[i].size + overhead;\r\n                    if (i + 1 === filesLength ||\r\n                            ((batchSize + files[i + 1].size + overhead) > limitSize) ||\r\n                            (limit && i + 1 - j >= limit)) {\r\n                        fileSet.push(files.slice(j, i + 1));\r\n                        paramNameSlice = paramName.slice(j, i + 1);\r\n                        if (!paramNameSlice.length) {\r\n                            paramNameSlice = paramName;\r\n                        }\r\n                        paramNameSet.push(paramNameSlice);\r\n                        j = i + 1;\r\n                        batchSize = 0;\r\n                    }\r\n                }\r\n            } else {\r\n                paramNameSet = paramName;\r\n            }\r\n            data.originalFiles = files;\r\n            langx.each(fileSet || files, function (index, element) {\r\n                var newData = langx.extend({}, data);\r\n                newData.files = fileSet ? element : [element];\r\n                newData.paramName = paramNameSet[index];\r\n                that._initResponseObject(newData);\r\n                that._initProgressObject(newData);\r\n                that._addConvenienceMethods(e, newData);\r\n                result = that._trigger(\r\n                    'add',\r\n                    eventer.create('add', {delegatedEvent: e}),\r\n                    newData\r\n                );\r\n                return result;\r\n            });\r\n            return result;\r\n        },\r\n\r\n        _initEventHandlers: function () {\r\n            var that = this;\r\n\r\n            filer.dropzone(this.options.dropZone[0],{\r\n                dropped : function (files) {\r\n                    var data = {};\r\n                    data.files = files;\r\n                    that._onAdd(null, data);\r\n                }\r\n            });\r\n            filer.pastezone(this.options.pasteZone[0],{\r\n                pasted : function (files) {\r\n                    var data = {};\r\n                    data.files = files;\r\n                    that._onAdd(null, data);\r\n                }\r\n            });\r\n\r\n            filer.picker(this.options.picker[0],{\r\n                multiple: true,\r\n                picked : function (files) {\r\n                    var data = {};\r\n                    data.files = files;\r\n                    that._onAdd(null, data);\r\n                }\r\n            });\r\n        },\r\n\r\n        _destroyEventHandlers: function () {\r\n            //this._off(this.options.dropZone, 'dragover drop');\r\n            //this._off(this.options.pasteZone, 'paste');\r\n            //this._off(this.options.picker, 'change');\r\n        },\r\n\r\n        _setOption: function (key, value) {\r\n            var reinit = langx.inArray(key, this._specialOptions) !== -1;\r\n            if (reinit) {\r\n                this._destroyEventHandlers();\r\n            }\r\n            this._super(key, value);\r\n            if (reinit) {\r\n                this._initSpecialOptions();\r\n                this._initEventHandlers();\r\n            }\r\n        },\r\n\r\n        _initSpecialOptions: function () {\r\n            var options = this.options;\r\n            //if (options.fileInput === undefined) {\r\n            //    //options.fileInput = this.element.is('input[type=\"file\"]') ?\r\n            //    //        this.element : this.element.find('input[type=\"file\"]');\r\n            //    options.fileInput = this.element.find('.fileinput-button');\r\n            \r\n            if (options.picker) {\r\n                if (!(options.picker instanceof $)) {\r\n                    options.picker = $(options.picker);\r\n                }                \r\n            }\r\n\r\n            if (options.dropZone) {\r\n                if (!(options.dropZone instanceof $)) {\r\n                    options.dropZone = $(options.dropZone);\r\n                }\r\n            }\r\n\r\n            if (options.pasteZone) {\r\n                if (!(options.pasteZone instanceof $)) {\r\n                    options.pasteZone = $(options.pasteZone);\r\n                }                \r\n            }\r\n        },\r\n\r\n        _getRegExp: function (str) {\r\n            var parts = str.split('/'),\r\n                modifiers = parts.pop();\r\n            parts.shift();\r\n            return new RegExp(parts.join('/'), modifiers);\r\n        },\r\n\r\n        _isRegExpOption: function (key, value) {\r\n            return key !== 'url' && langx.type(value) === 'string' &&\r\n                /^\\/.*\\/[igm]{0,3}$/.test(value);\r\n        },\r\n\r\n        _construct: function (elm,options) {\r\n            this._elm = elm;\r\n            this.options = langx.mixin({},this.options,options);\r\n            this._initSpecialOptions();\r\n            this._slots = [];\r\n            this._sequence = this._getXHRPromise(true);\r\n            this._sending = this._active = 0;\r\n            this._initProgressObject(this);\r\n            this._initEventHandlers();\r\n        },\r\n\r\n        // This method is exposed to the widget API and allows to query\r\n        // the number of active uploads:\r\n        active: function () {\r\n            return this._active;\r\n        },\r\n\r\n        // This method is exposed to the widget API and allows to query\r\n        // the widget upload progress.\r\n        // It returns an object with loaded, total and bitrate properties\r\n        // for the running uploads:\r\n        progress: function () {\r\n            return this._progress;\r\n        },\r\n\r\n        // This method is exposed to the widget API and allows adding files\r\n        // using the fileupload API. The data parameter accepts an object which\r\n        // must have a files property and can contain additional options:\r\n        // .fileupload('add', {files: filesList});\r\n        add: function (data) {\r\n            var that = this;\r\n            if (!data || this.options.disabled) {\r\n                return;\r\n            }\r\n            data.files = langx.makeArray(data.files);\r\n            this._onAdd(null, data);\r\n        },\r\n\r\n        // This method is exposed to the widget API and allows sending files\r\n        // using the fileupload API. The data parameter accepts an object which\r\n        // must have a files or fileInput property and can contain additional options:\r\n        // .fileupload('send', {files: filesList});\r\n        // The method returns a Promise object for the file upload call.\r\n        send: function (data) {\r\n            if (data && !this.options.disabled) {\r\n                data.files = langx.makeArray(data.files);\r\n                if (data.files.length) {\r\n                    return this._onSend(null, data);\r\n                }\r\n            }\r\n            return this._getXHRPromise(false, data && data.context);\r\n        }\r\n\r\n    });\r\n\r\n\r\n    function uploader(elm,options) {\r\n        var fuInst = new FileUploader(elm,options);\r\n        fuInst.on(\"all\",function(evt,data){\r\n            var typ = evt.type;\r\n            if (langx.isFunction(options[typ])) {\r\n                options[typ].call(fuInst._elm,evt,data);\r\n            }\r\n        });\r\n    }\r\n\r\n    return uploader;\r\n\r\n});\r\n\ndefine('skylark-blueimp-uploader/fileupload-ui',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-jquery\",\r\n    \"./tmpl\",\r\n    \"./fileupload\"\r\n],function (langx,eventer,$,tmpl,uploader) {\r\n\r\n    'use strict';\r\n\r\n//    $.blueimp.fileupload.prototype._specialOptions.push(\r\n//        'filesContainer',\r\n//        'uploadTemplateId',\r\n//        'downloadTemplateId'\r\n//    );\r\n\r\n    // The UI version extends the file upload widget\r\n    // and adds complete user interface interaction:\r\n    $.widget('blueimp.fileuploadui',  {\r\n        processActions: {\r\n            /*\r\n            log: function (data, options) {\r\n                console[options.type](\r\n                    'Processing \"' + data.files[data.index].name + '\"'\r\n                );\r\n            }\r\n            */\r\n        },\r\n\r\n        _processFile: function (data, originalData) {\r\n            /*\r\n            var that = this,\r\n                dfd = $.Deferred().resolveWith(that, [data]),\r\n                chain = dfd.promise();\r\n            this._trigger('process', null, data);\r\n            $.each(data.processQueue, function (i, settings) {\r\n                var func = function (data) {\r\n                    if (originalData.errorThrown) {\r\n                        return $.Deferred()\r\n                                .rejectWith(that, [originalData]).promise();\r\n                    }\r\n                    return that.processActions[settings.action].call(\r\n                        that,\r\n                        data,\r\n                        settings\r\n                    );\r\n                };\r\n                chain = chain.pipe(func, settings.always && func);\r\n            });\r\n            chain\r\n                .done(function () {\r\n                    that._trigger('processdone', null, data);\r\n                    that._trigger('processalways', null, data);\r\n                })\r\n                .fail(function () {\r\n                    that._trigger('processfail', null, data);\r\n                    that._trigger('processalways', null, data);\r\n                });\r\n            return chain;\r\n            */\r\n            var langx = $.skylark.langx,\r\n                that = this;\r\n            var funcs = langx.map(data.processQueue,function(setting) {\r\n                var func = function (data) {\r\n                    return that.processActions[setting.action].call(\r\n                        that,\r\n                        data,\r\n                        setting\r\n                    );\r\n                };\r\n                return func;                \r\n            });\r\n            return langx.async.waterful(funcs,[data],that);\r\n        },\r\n\r\n        // Replaces the settings of each processQueue item that\r\n        // are strings starting with an \"@\", using the remaining\r\n        // substring as key for the option map,\r\n        // e.g. \"@autoUpload\" is replaced with options.autoUpload:\r\n        _transformProcessQueue: function (options) {\r\n            var processQueue = [];\r\n            $.each(options.processQueue, function () {\r\n                var settings = {},\r\n                    action = this.action,\r\n                    prefix = this.prefix === true ? action : this.prefix;\r\n                $.each(this, function (key, value) {\r\n                    if ($.type(value) === 'string' &&\r\n                            value.charAt(0) === '@') {\r\n                        settings[key] = options[\r\n                            value.slice(1) || (prefix ? prefix +\r\n                                key.charAt(0).toUpperCase() + key.slice(1) : key)\r\n                        ];\r\n                    } else {\r\n                        settings[key] = value;\r\n                    }\r\n\r\n                });\r\n                processQueue.push(settings);\r\n            });\r\n            options.processQueue = processQueue;\r\n        },\r\n\r\n        // Returns the number of files currently in the processsing queue:\r\n        processing: function () {\r\n            return this._processing;\r\n        },\r\n\r\n        // Processes the files given as files property of the data parameter,\r\n        // returns a Promise object that allows to bind callbacks:\r\n        process: function (data) {\r\n            var that = this,\r\n                options = $.extend({}, this.options, data);\r\n            if (options.processQueue && options.processQueue.length) {\r\n                this._transformProcessQueue(options);\r\n                if (this._processing === 0) {\r\n                    this._trigger('processstart');\r\n                }\r\n                $.each(data.files, function (index) {\r\n                    var opts = index ? $.extend({}, options) : options,\r\n                        func = function () {\r\n                            if (data.errorThrown) {\r\n                                return $.Deferred()\r\n                                        .rejectWith(that, [data]).promise();\r\n                            }\r\n                            return that._processFile(opts, data);\r\n                        };\r\n                    opts.index = index;\r\n                    that._processing += 1;\r\n                    that._processingQueue = that._processingQueue.pipe(func, func)\r\n                        .always(function () {\r\n                            that._processing -= 1;\r\n                            if (that._processing === 0) {\r\n                                that._trigger('processstop');\r\n                            }\r\n                        });\r\n                });\r\n            }\r\n            return this._processingQueue;\r\n        },\r\n\r\n\r\n        options: {\r\n            // The list of processing actions:\r\n            processQueue: [\r\n                /*\r\n                {\r\n                    action: 'log',\r\n                    type: 'debug'\r\n                }\r\n                */\r\n            ],\r\n\r\n\r\n\r\n            // By default, files added to the widget are uploaded as soon\r\n            // as the user clicks on the start buttons. To enable automatic\r\n            // uploads, set the following option to true:\r\n            autoUpload: false,\r\n            // The ID of the upload template:\r\n            uploadTemplateId: 'template-upload',\r\n            // The ID of the download template:\r\n            downloadTemplateId: 'template-download',\r\n            // The container for the list of files. If undefined, it is set to\r\n            // an element with class \"files\" inside of the widget element:\r\n            filesContainer: undefined,\r\n            // By default, files are appended to the files container.\r\n            // Set the following option to true, to prepend files instead:\r\n            prependFiles: false,\r\n            // The expected data type of the upload response, sets the dataType\r\n            // option of the $.ajax upload requests:\r\n            dataType: 'json',\r\n\r\n            // Function returning the current number of files,\r\n            // used by the maxNumberOfFiles validation:\r\n            getNumberOfFiles: function () {\r\n                return this.filesContainer.children()\r\n                    .not('.processing').length;\r\n            },\r\n\r\n            // Callback to retrieve the list of files from the server response:\r\n            getFilesFromResponse: function (data) {\r\n                if (data.result && $.isArray(data.result.files)) {\r\n                    return data.result.files;\r\n                }\r\n                return [];\r\n            },\r\n\r\n            // The add callback is invoked as soon as files are added to the fileupload\r\n            // widget (via file input selection, drag & drop or add API call).\r\n            // See the basic file upload widget for more information:\r\n            add: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var $this = $(this),\r\n                    that = $this.data('blueimp-fileuploadui') ||\r\n                        $this.data('fileupload'),\r\n                    options = that.options;\r\n                data.context = that._renderUpload(data.files)\r\n                    .data('data', data)\r\n                    .addClass('processing');\r\n                options.filesContainer[\r\n                    options.prependFiles ? 'prepend' : 'append'\r\n                ](data.context);\r\n                that._forceReflow(data.context);\r\n                that._transition(data.context);\r\n//                data.process(function () {\r\n//                    return $this.fileupload('process', data);\r\n//                }).always(function () {\r\n                $this.fileuploadui('process', data).always(function () {\r\n                    data.context.each(function (index) {\r\n                        $(this).find('.size').text(\r\n                            that._formatFileSize(data.files[index].size)\r\n                        );\r\n                    }).removeClass('processing');\r\n                    that._renderPreviews(data);\r\n                }).done(function () {\r\n                    data.context.find('.start').prop('disabled', false);\r\n                    if ((that._trigger('added', null,data) !== false) &&\r\n                            (options.autoUpload || data.autoUpload) &&\r\n                            data.autoUpload !== false) {\r\n                        data.submit();\r\n                    }\r\n                }).fail(function () {\r\n                    if (data.files.error) {\r\n                        data.context.each(function (index) {\r\n                            var error = data.files[index].error;\r\n                            if (error) {\r\n                                $(this).find('.error').text(error);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n            // Callback for the start of each file upload request:\r\n            send: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload');\r\n                if (data.context && data.dataType &&\r\n                        data.dataType.substr(0, 6) === 'iframe') {\r\n                    // Iframe Transport does not support progress events.\r\n                    // In lack of an indeterminate progress bar, we set\r\n                    // the progress to 100%, showing the full animated bar:\r\n                    data.context\r\n                        .find('.progress').addClass(\r\n                            !$.support.transition && 'progress-animated'\r\n                        )\r\n                        .attr('aria-valuenow', 100)\r\n                        .children().first().css(\r\n                            'width',\r\n                            '100%'\r\n                        );\r\n                }\r\n                return that._trigger('sent', null,data);\r\n            },\r\n            // Callback for successful uploads:\r\n            done: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    getFilesFromResponse = data.getFilesFromResponse ||\r\n                        that.options.getFilesFromResponse,\r\n                    files = getFilesFromResponse(data),\r\n                    template,\r\n                    deferred;\r\n                if (data.context) {\r\n                    data.context.each(function (index) {\r\n                        var file = files[index] ||\r\n                                {error: 'Empty file upload result'};\r\n                        deferred = that._addFinishedDeferreds();\r\n                        that._transition($(this)).done(\r\n                            function () {\r\n                                var node = $(this);\r\n//                                template = that._renderDownload([file]);\r\n                                template = that._renderDownload([file])\r\n                                    .replaceAll(node);\r\n                                that._forceReflow(template);\r\n                                that._transition(template).done(\r\n                                    function () {\r\n                                        data.context = $(this);\r\n                                        that._trigger('completed', null,data);\r\n                                        that._trigger('finished', null,data);\r\n                                        deferred.resolve();\r\n                                    }\r\n                                );\r\n                            }\r\n                        );\r\n                    });\r\n                } else {\r\n                    template = that._renderDownload(files)[\r\n                        that.options.prependFiles ? 'prependTo' : 'appendTo'\r\n                    ](that.options.filesContainer);\r\n                    that._forceReflow(template);\r\n                    deferred = that._addFinishedDeferreds();\r\n                    that._transition(template).done(\r\n                        function () {\r\n                            data.context = $(this);\r\n                            that._trigger('completed', null,data);\r\n                            that._trigger('finished', null,data);\r\n                            deferred.resolve();\r\n                        }\r\n                    );\r\n                }\r\n            },\r\n            // Callback for failed (abort or error) uploads:\r\n            fail: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    template,\r\n                    deferred;\r\n                if (data.context) {\r\n                    data.context.each(function (index) {\r\n                        if (data.errorThrown !== 'abort') {\r\n                            var file = data.files[index];\r\n                            file.error = file.error || data.errorThrown ||\r\n                                true;\r\n                            deferred = that._addFinishedDeferreds();\r\n                            that._transition($(this)).done(\r\n                                function () {\r\n                                    var node = $(this);\r\n                                    template = that._renderDownload([file])\r\n                                        .replaceAll(node);\r\n                                    that._forceReflow(template);\r\n                                    that._transition(template).done(\r\n                                        function () {\r\n                                            data.context = $(this);\r\n                                            that._trigger('failed', null,data);\r\n                                            that._trigger('finished', null,data);\r\n                                            deferred.resolve();\r\n                                        }\r\n                                    );\r\n                                }\r\n                            );\r\n                        } else {\r\n                            deferred = that._addFinishedDeferreds();\r\n                            that._transition($(this)).done(\r\n                                function () {\r\n                                    $(this).remove();\r\n                                    that._trigger('failed', null,data);\r\n                                    that._trigger('finished', null,data);\r\n                                    deferred.resolve();\r\n                                }\r\n                            );\r\n                        }\r\n                    });\r\n                } else if (data.errorThrown !== 'abort') {\r\n                    data.context = that._renderUpload(data.files)[\r\n                        that.options.prependFiles ? 'prependTo' : 'appendTo'\r\n                    ](that.options.filesContainer)\r\n                        .data('data', data);\r\n                    that._forceReflow(data.context);\r\n                    deferred = that._addFinishedDeferreds();\r\n                    that._transition(data.context).done(\r\n                        function () {\r\n                            data.context = $(this);\r\n                            that._trigger('failed', null,data);\r\n                            that._trigger('finished', null,data);\r\n                            deferred.resolve();\r\n                        }\r\n                    );\r\n                } else {\r\n                    that._trigger('failed', null,data);\r\n                    that._trigger('finished', null,data);\r\n                    that._addFinishedDeferreds().resolve();\r\n                }\r\n            },\r\n            // Callback for upload progress events:\r\n            progress: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var progress = Math.floor(data.loaded / data.total * 100);\r\n                if (data.context) {\r\n                    data.context.each(function () {\r\n                        $(this).find('.progress')\r\n                            .attr('aria-valuenow', progress)\r\n                            .children().first().css(\r\n                                'width',\r\n                                progress + '%'\r\n                            );\r\n                    });\r\n                }\r\n            },\r\n            // Callback for global upload progress events:\r\n            progressall: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var $this = $(this),\r\n                    progress = Math.floor(data.loaded / data.total * 100),\r\n                    globalProgressNode = $this.find('.fileupload-progress'),\r\n                    extendedProgressNode = globalProgressNode\r\n                        .find('.progress-extended');\r\n                if (extendedProgressNode.length) {\r\n                    extendedProgressNode.html(\r\n                        ($this.data('blueimp-fileuploadui') || $this.data('fileupload'))\r\n                            ._renderExtendedProgress(data)\r\n                    );\r\n                }\r\n                globalProgressNode\r\n                    .find('.progress')\r\n                    .attr('aria-valuenow', progress)\r\n                    .children().first().css(\r\n                        'width',\r\n                        progress + '%'\r\n                    );\r\n            },\r\n            // Callback for uploads start, equivalent to the global ajaxStart event:\r\n            start: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload');\r\n                that._resetFinishedDeferreds();\r\n                that._transition($(this).find('.fileupload-progress')).done(\r\n                    function () {\r\n                        that._trigger('started', null);\r\n                    }\r\n                );\r\n            },\r\n            // Callback for uploads stop, equivalent to the global ajaxStop event:\r\n            stop: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    deferred = that._addFinishedDeferreds();\r\n                $.when.apply($, that._getFinishedDeferreds())\r\n                    .done(function () {\r\n                        that._trigger('stopped', null);\r\n                    });\r\n                that._transition($(this).find('.fileupload-progress')).done(\r\n                    function () {\r\n                        $(this).find('.progress')\r\n                            .attr('aria-valuenow', '0')\r\n                            .children().first().css('width', '0%');\r\n                        $(this).find('.progress-extended').html('&nbsp;');\r\n                        deferred.resolve();\r\n                    }\r\n                );\r\n            },\r\n            processstart: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                $(this).addClass('fileupload-processing');\r\n            },\r\n            processstop: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                $(this).removeClass('fileupload-processing');\r\n            },\r\n            // Callback for file deletion:\r\n            destroy: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    removeNode = function () {\r\n                        that._transition(data.context).done(\r\n                            function () {\r\n                                $(this).remove();\r\n                                that._trigger('destroyed', null,data);\r\n                            }\r\n                        );\r\n                    };\r\n                if (data.url) {\r\n                    data.dataType = data.dataType || that.options.dataType;\r\n                    $.ajax(data).done(removeNode).fail(function () {\r\n                        that._trigger('destroyfailed', null,data);\r\n                    });\r\n                } else {\r\n                    removeNode();\r\n                }\r\n            }\r\n        },\r\n\r\n\r\n        _resetFinishedDeferreds: function () {\r\n            this._finishedUploads = [];\r\n        },\r\n\r\n        _addFinishedDeferreds: function (deferred) {\r\n            if (!deferred) {\r\n                deferred = $.Deferred();\r\n            }\r\n            this._finishedUploads.push(deferred);\r\n            return deferred;\r\n        },\r\n\r\n        _getFinishedDeferreds: function () {\r\n            return this._finishedUploads;\r\n        },\r\n\r\n        // Link handler, that allows to download files\r\n        // by drag & drop of the links to the desktop:\r\n        _enableDragToDesktop: function () {\r\n            var link = $(this),\r\n                url = link.prop('href'),\r\n                name = link.prop('download'),\r\n                type = 'application/octet-stream';\r\n            link.bind('dragstart', function (e) {\r\n                try {\r\n                    e.originalEvent.dataTransfer.setData(\r\n                        'DownloadURL',\r\n                        [type, name, url].join(':')\r\n                    );\r\n                } catch (ignore) {}\r\n            });\r\n        },\r\n\r\n        _formatFileSize: function (bytes) {\r\n            if (typeof bytes !== 'number') {\r\n                return '';\r\n            }\r\n            if (bytes >= 1000000000) {\r\n                return (bytes / 1000000000).toFixed(2) + ' GB';\r\n            }\r\n            if (bytes >= 1000000) {\r\n                return (bytes / 1000000).toFixed(2) + ' MB';\r\n            }\r\n            return (bytes / 1000).toFixed(2) + ' KB';\r\n        },\r\n\r\n        _formatBitrate: function (bits) {\r\n            if (typeof bits !== 'number') {\r\n                return '';\r\n            }\r\n            if (bits >= 1000000000) {\r\n                return (bits / 1000000000).toFixed(2) + ' Gbit/s';\r\n            }\r\n            if (bits >= 1000000) {\r\n                return (bits / 1000000).toFixed(2) + ' Mbit/s';\r\n            }\r\n            if (bits >= 1000) {\r\n                return (bits / 1000).toFixed(2) + ' kbit/s';\r\n            }\r\n            return bits.toFixed(2) + ' bit/s';\r\n        },\r\n\r\n        _formatTime: function (seconds) {\r\n            var date = new Date(seconds * 1000),\r\n                days = Math.floor(seconds / 86400);\r\n            days = days ? days + 'd ' : '';\r\n            return days +\r\n                ('0' + date.getUTCHours()).slice(-2) + ':' +\r\n                ('0' + date.getUTCMinutes()).slice(-2) + ':' +\r\n                ('0' + date.getUTCSeconds()).slice(-2);\r\n        },\r\n\r\n        _formatPercentage: function (floatValue) {\r\n            return (floatValue * 100).toFixed(2) + ' %';\r\n        },\r\n\r\n        _renderExtendedProgress: function (data) {\r\n            return this._formatBitrate(data.bitrate) + ' | ' +\r\n                this._formatTime(\r\n                    (data.total - data.loaded) * 8 / data.bitrate\r\n                ) + ' | ' +\r\n                this._formatPercentage(\r\n                    data.loaded / data.total\r\n                ) + ' | ' +\r\n                this._formatFileSize(data.loaded) + ' / ' +\r\n                this._formatFileSize(data.total);\r\n        },\r\n\r\n        _renderTemplate: function (func, files) {\r\n            if (!func) {\r\n                return $();\r\n            }\r\n            var result = func({\r\n                files: files,\r\n                formatFileSize: this._formatFileSize,\r\n                options: this.options\r\n            });\r\n            if (result instanceof $) {\r\n                return result;\r\n            }\r\n            return $(this.options.templatesContainer).html(result).children();\r\n        },\r\n\r\n        _renderPreviews: function (data) {\r\n            data.context.find('.preview').each(function (index, elm) {\r\n                $(elm).append(data.files[index].preview);\r\n            });\r\n        },\r\n\r\n        _renderUpload: function (files) {\r\n            return this._renderTemplate(\r\n                this.options.uploadTemplate,\r\n                files\r\n            );\r\n        },\r\n\r\n        _renderDownload: function (files) {\r\n            return this._renderTemplate(\r\n                this.options.downloadTemplate,\r\n                files\r\n            ).find('a[download]').each(this._enableDragToDesktop).end();\r\n        },\r\n\r\n        _startHandler: function (e) {\r\n            e.preventDefault();\r\n            var button = $(e.currentTarget),\r\n                template = button.closest('.template-upload'),\r\n                data = template.data('data');\r\n            button.prop('disabled', true);\r\n            if (data && data.submit) {\r\n                data.submit();\r\n            }\r\n        },\r\n\r\n        _cancelHandler: function (e) {\r\n            e.preventDefault();\r\n            var template = $(e.currentTarget)\r\n                    .closest('.template-upload,.template-download'),\r\n                data = template.data('data') || {};\r\n            data.context = data.context || template;\r\n            if (data.abort) {\r\n                data.abort();\r\n            } else {\r\n                data.errorThrown = 'abort';\r\n                this._trigger('fail', null,data);\r\n            }\r\n        },\r\n\r\n        _deleteHandler: function (e) {\r\n            e.preventDefault();\r\n            var button = $(e.currentTarget);\r\n            this._trigger('destroy', null, $.extend({\r\n                context: button.closest('.template-download'),\r\n                type: 'DELETE'\r\n            }, button.data()));\r\n        },\r\n\r\n        _forceReflow: function (node) {\r\n            return $.support.transition && node.length &&\r\n                node[0].offsetWidth;\r\n        },\r\n\r\n        _transition: function (node) {\r\n            var dfd = $.Deferred();\r\n            if ($.support.transition && node.hasClass('fade') && node.is(':visible')) {\r\n                node.bind(\r\n                    $.support.transition.end,\r\n                    function (e) {\r\n                        // Make sure we don't respond to other transitions events\r\n                        // in the container element, e.g. from button elements:\r\n                        if (e.target === node[0]) {\r\n                            node.unbind($.support.transition.end);\r\n                            dfd.resolveWith(node);\r\n                        }\r\n                    }\r\n                ).toggleClass('in');\r\n            } else {\r\n                node.toggleClass('in');\r\n                dfd.resolveWith(node);\r\n            }\r\n            return dfd;\r\n        },\r\n\r\n        _initButtonBarEventHandlers: function () {\r\n            var fileUploadButtonBar = this.element.find('.fileupload-buttonbar'),\r\n                filesList = this.options.filesContainer;\r\n            this._on(fileUploadButtonBar.find('.start'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.start').click();\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.cancel'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.cancel').click();\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.delete'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.toggle:checked')\r\n                        .closest('.template-download')\r\n                        .find('.delete').click();\r\n                    fileUploadButtonBar.find('.toggle')\r\n                        .prop('checked', false);\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.toggle'), {\r\n                change: function (e) {\r\n                    filesList.find('.toggle').prop(\r\n                        'checked',\r\n                        $(e.currentTarget).is(':checked')\r\n                    );\r\n                }\r\n            });\r\n        },\r\n\r\n        _destroyButtonBarEventHandlers: function () {\r\n            this._off(\r\n                this.element.find('.fileupload-buttonbar')\r\n                    .find('.start, .cancel, .delete'),\r\n                'click'\r\n            );\r\n            this._off(\r\n                this.element.find('.fileupload-buttonbar .toggle'),\r\n                'change.'\r\n            );\r\n        },\r\n\r\n        _initEventHandlers: function () {\r\n            //this._super();\r\n            this._on(this.options.filesContainer, {\r\n                'click .start': this._startHandler,\r\n                'click .cancel': this._cancelHandler,\r\n                'click .delete': this._deleteHandler\r\n            });\r\n            this._initButtonBarEventHandlers();\r\n        },\r\n\r\n        _destroyEventHandlers: function () {\r\n            this._destroyButtonBarEventHandlers();\r\n            this._off(this.options.filesContainer, 'click');\r\n            this._super();\r\n        },\r\n\r\n        _enableFileInputButton: function () {\r\n            this.element.find('.fileinput-button input')\r\n                .prop('disabled', false)\r\n                .parent().removeClass('disabled');\r\n        },\r\n\r\n        _disableFileInputButton: function () {\r\n            this.element.find('.fileinput-button input')\r\n                .prop('disabled', true)\r\n                .parent().addClass('disabled');\r\n        },\r\n\r\n        _initTemplates: function () {\r\n            var options = this.options;\r\n            options.templatesContainer = this.document[0].createElement(\r\n                options.filesContainer.prop('nodeName')\r\n            );\r\n            if (tmpl) {\r\n                if (options.uploadTemplateId) {\r\n                    options.uploadTemplate = tmpl(options.uploadTemplateId);\r\n                }\r\n                if (options.downloadTemplateId) {\r\n                    options.downloadTemplate = tmpl(options.downloadTemplateId);\r\n                }\r\n            }\r\n        },\r\n\r\n        _initFilesContainer: function () {\r\n            var options = this.options;\r\n            if (options.filesContainer === undefined) {\r\n                options.filesContainer = this.element.find('.files');\r\n            } else if (!(options.filesContainer instanceof $)) {\r\n                options.filesContainer = $(options.filesContainer);\r\n            }\r\n        },\r\n\r\n        _initSpecialOptions: function () {\r\n            //this._super();\r\n            this._initFilesContainer();\r\n            this._initTemplates();\r\n        },\r\n\r\n        _create: function () {\r\n            this._super();\r\n\r\n            this._processing = 0;\r\n            this._processingQueue = $.Deferred().resolveWith(this)\r\n                .promise();\r\n\r\n\r\n            this._initSpecialOptions();\r\n            this._initEventHandlers();\r\n\r\n            //$(this.element).fileupload(this.options);\r\n            this._uploader = uploader(this.element,this.options);\r\n            this._resetFinishedDeferreds();\r\n            if (!$.support.fileInput) {\r\n                this._disableFileInputButton();\r\n            }\r\n        },\r\n\r\n        enable: function () {\r\n            var wasDisabled = false;\r\n            if (this.options.disabled) {\r\n                wasDisabled = true;\r\n            }\r\n            this._super();\r\n            if (wasDisabled) {\r\n                this.element.find('input, button').prop('disabled', false);\r\n                this._enableFileInputButton();\r\n            }\r\n        },\r\n\r\n        disable: function () {\r\n            if (!this.options.disabled) {\r\n                this.element.find('input, button').prop('disabled', true);\r\n                this._disableFileInputButton();\r\n            }\r\n            this._super();\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n});\r\n\ndefine('skylark-blueimp-uploader/addons/image',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-utils-imagex\",\r\n    'skylark-jquery',\r\n    \"../fileupload-ui\"\r\n],function (langx,eventer,imagex,$) {\r\n    'use strict';\r\n\r\n    // Prepend to the default processQueue:\r\n    $.blueimp.fileuploadui.prototype.options.processQueue.unshift(\r\n        {\r\n            action: 'loadImageMetaData',\r\n            disableImageHead: '@',\r\n            disableExif: '@',\r\n            disableExifThumbnail: '@',\r\n            disableExifSub: '@',\r\n            disableExifGps: '@',\r\n            disabled: '@disableImageMetaDataLoad'\r\n        },\r\n        {\r\n            action: 'loadImage',\r\n            // Use the action as prefix for the \"@\" options:\r\n            prefix: true,\r\n            fileTypes: '@',\r\n            maxFileSize: '@',\r\n            noRevoke: '@',\r\n            disabled: '@disableImageLoad'\r\n        },\r\n        {\r\n            action: 'resizeImage',\r\n            // Use \"image\" as prefix for the \"@\" options:\r\n            prefix: 'image',\r\n            maxWidth: '@',\r\n            maxHeight: '@',\r\n            minWidth: '@',\r\n            minHeight: '@',\r\n            crop: '@',\r\n            orientation: '@',\r\n            forceResize: '@',\r\n            disabled: '@disableImageResize'\r\n        },\r\n        {\r\n            action: 'saveImage',\r\n            quality: '@imageQuality',\r\n            type: '@imageType',\r\n            disabled: '@disableImageResize'\r\n        },\r\n        {\r\n            action: 'saveImageMetaData',\r\n            disabled: '@disableImageMetaDataSave'\r\n        },\r\n        {\r\n            action: 'resizeImage',\r\n            // Use \"preview\" as prefix for the \"@\" options:\r\n            prefix: 'preview',\r\n            maxWidth: '@',\r\n            maxHeight: '@',\r\n            minWidth: '@',\r\n            minHeight: '@',\r\n            crop: '@',\r\n            orientation: '@',\r\n            thumbnail: '@',\r\n            canvas: '@',\r\n            disabled: '@disableImagePreview'\r\n        },\r\n        {\r\n            action: 'setImage',\r\n            name: '@imagePreviewName',\r\n            disabled: '@disableImagePreview'\r\n        },\r\n        {\r\n            action: 'deleteImageReferences',\r\n            disabled: '@disableImageReferencesDeletion'\r\n        }\r\n    );\r\n\r\n    // The File Upload Resize plugin extends the fileupload widget\r\n    // with image resize functionality:\r\n    $.widget('blueimp.fileuploadui', $.blueimp.fileuploadui, {\r\n\r\n        options: {\r\n            // The regular expression for the types of images to load:\r\n            // matched against the file type:\r\n            loadImageFileTypes: /^image\\/(gif|jpeg|png|svg\\+xml)$/,\r\n            // The maximum file size of images to load:\r\n            loadImageMaxFileSize: 10000000, // 10MB\r\n            // The maximum width of resized images:\r\n            imageMaxWidth: 1920,\r\n            // The maximum height of resized images:\r\n            imageMaxHeight: 1080,\r\n            // Defines the image orientation (1-8) or takes the orientation\r\n            // value from Exif data if set to true:\r\n            imageOrientation: false,\r\n            // Define if resized images should be cropped or only scaled:\r\n            imageCrop: false,\r\n            // Disable the resize image functionality by default:\r\n            disableImageResize: true,\r\n            // The maximum width of the preview images:\r\n            previewMaxWidth: 80,\r\n            // The maximum height of the preview images:\r\n            previewMaxHeight: 80,\r\n            // Defines the preview orientation (1-8) or takes the orientation\r\n            // value from Exif data if set to true:\r\n            previewOrientation: true,\r\n            // Create the preview using the Exif data thumbnail:\r\n            previewThumbnail: true,\r\n            // Define if preview images should be cropped or only scaled:\r\n            previewCrop: false,\r\n            // Define if preview images should be resized as canvas elements:\r\n            previewCanvas: true\r\n        },\r\n\r\n        processActions: {\r\n\r\n            // Loads the image given via data.files and data.index\r\n            // as img element, if the browser supports the File API.\r\n            // Accepts the options fileTypes (regular expression)\r\n            // and maxFileSize (integer) to limit the files to load:\r\n            loadImage: function (data, options) {\r\n                if (options.disabled) {\r\n                    return data;\r\n                }\r\n                var that = this,\r\n                    file = data.files[data.index],\r\n                    dfd = $.Deferred();\r\n                if (($.type(options.maxFileSize) === 'number' &&\r\n                            file.size > options.maxFileSize) ||\r\n                        (options.fileTypes &&\r\n                            !options.fileTypes.test(file.type)) ||\r\n                        !imagex.loadFile(\r\n                            file,\r\n                            function (img) {\r\n                                if (img.src) {\r\n                                    data.img = img;\r\n                                }\r\n                                dfd.resolveWith(that, [data]);\r\n                            },\r\n                            options\r\n                        )) {\r\n                    return data;\r\n                }\r\n                return dfd.promise();\r\n            },\r\n\r\n            // Resizes the image given as data.canvas or data.img\r\n            // and updates data.canvas or data.img with the resized image.\r\n            // Also stores the resized image as preview property.\r\n            // Accepts the options maxWidth, maxHeight, minWidth,\r\n            // minHeight, canvas and crop:\r\n            resizeImage: function (data, options) {\r\n                if (options.disabled || !(data.canvas || data.img)) {\r\n                    return data;\r\n                }\r\n                options = $.extend({canvas: true}, options);\r\n                var that = this,\r\n                    dfd = $.Deferred(),\r\n                    img = (options.canvas && data.canvas) || data.img,\r\n                    resolve = function (newImg) {\r\n                        if (newImg && (newImg.width !== img.width ||\r\n                                newImg.height !== img.height ||\r\n                                options.forceResize)) {\r\n                            data[newImg.getContext ? 'canvas' : 'img'] = newImg;\r\n                        }\r\n                        data.preview = newImg;\r\n                        dfd.resolveWith(that, [data]);\r\n                    },\r\n                    thumbnail;\r\n                if (data.exif) {\r\n                    if (options.orientation === true) {\r\n                        options.orientation = data.exif.get('Orientation');\r\n                    }\r\n                    if (options.thumbnail) {\r\n                        thumbnail = data.exif.get('Thumbnail');\r\n                        if (thumbnail) {\r\n                            imagex.loadFile(thumbnail, resolve, options);\r\n                            return dfd.promise();\r\n                        }\r\n                    }\r\n                    // Prevent orienting the same image twice:\r\n                    if (data.orientation) {\r\n                        delete options.orientation;\r\n                    } else {\r\n                        data.orientation = options.orientation;\r\n                    }\r\n                }\r\n                if (img) {\r\n                    resolve(imagex.scale(img, options));\r\n                    return dfd.promise();\r\n                }\r\n                return data;\r\n            },\r\n\r\n            // Saves the processed image given as data.canvas\r\n            // inplace at data.index of data.files:\r\n            saveImage: function (data, options) {\r\n                if (!data.canvas || options.disabled) {\r\n                    return data;\r\n                }\r\n                var that = this,\r\n                    file = data.files[data.index],\r\n                    dfd = $.Deferred();\r\n                if (data.canvas.toBlob) {\r\n                    data.canvas.toBlob(\r\n                        function (blob) {\r\n                            if (!blob.name) {\r\n                                if (file.type === blob.type) {\r\n                                    blob.name = file.name;\r\n                                } else if (file.name) {\r\n                                    blob.name = file.name.replace(\r\n                                        /\\..+$/,\r\n                                        '.' + blob.type.substr(6)\r\n                                    );\r\n                                }\r\n                            }\r\n                            // Don't restore invalid meta data:\r\n                            if (file.type !== blob.type) {\r\n                                delete data.imageHead;\r\n                            }\r\n                            // Store the created blob at the position\r\n                            // of the original file in the files list:\r\n                            data.files[data.index] = blob;\r\n                            dfd.resolveWith(that, [data]);\r\n                        },\r\n                        options.type || file.type,\r\n                        options.quality\r\n                    );\r\n                } else {\r\n                    return data;\r\n                }\r\n                return dfd.promise();\r\n            },\r\n\r\n            loadImageMetaData: function (data, options) {\r\n                if (options.disabled) {\r\n                    return data;\r\n                }\r\n                var that = this,\r\n                    dfd = $.Deferred();\r\n                imagex.meta.parseMetaData(data.files[data.index], function (result) {\r\n                    $.extend(data, result);\r\n                    dfd.resolveWith(that, [data,\"aaa\"]);\r\n                }, options);\r\n                return dfd.promise();\r\n            },\r\n\r\n            saveImageMetaData: function (data, options) {\r\n                if (!(data.imageHead && data.canvas &&\r\n                        data.canvas.toBlob && !options.disabled)) {\r\n                    return data;\r\n                }\r\n                var file = data.files[data.index],\r\n                    blob = new Blob([\r\n                        data.imageHead,\r\n                        // Resized images always have a head size of 20 bytes,\r\n                        // including the JPEG marker and a minimal JFIF header:\r\n                        this._blobSlice.call(file, 20)\r\n                    ], {type: file.type});\r\n                blob.name = file.name;\r\n                data.files[data.index] = blob;\r\n                return data;\r\n            },\r\n\r\n            // Sets the resized version of the image as a property of the\r\n            // file object, must be called after \"saveImage\":\r\n            setImage: function (data, options) {\r\n                if (data.preview && !options.disabled) {\r\n                    data.files[data.index][options.name || 'preview'] = data.preview;\r\n                }\r\n                return data;\r\n            },\r\n\r\n            deleteImageReferences: function (data, options) {\r\n                if (!options.disabled) {\r\n                    delete data.img;\r\n                    delete data.canvas;\r\n                    delete data.preview;\r\n                    delete data.imageHead;\r\n                }\r\n                return data;\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n});\r\n\ndefine('skylark-blueimp-uploader/addons/audio',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-utils-imagex\",\r\n    'skylark-jquery',\r\n    \"../fileupload-ui\"\r\n],function (langx,eventer,imagex,$) {\r\n    'use strict';\r\n\r\n    // Prepend to the default processQueue:\r\n    $.blueimp.fileuploadui.prototype.options.processQueue.unshift(\r\n        {\r\n            action: 'loadAudio',\r\n            // Use the action as prefix for the \"@\" options:\r\n            prefix: true,\r\n            fileTypes: '@',\r\n            maxFileSize: '@',\r\n            disabled: '@disableAudioPreview'\r\n        },\r\n        {\r\n            action: 'setAudio',\r\n            name: '@audioPreviewName',\r\n            disabled: '@disableAudioPreview'\r\n        }\r\n    );\r\n\r\n    // The File Upload Audio Preview plugin extends the fileupload widget\r\n    // with audio preview functionality:\r\n    $.widget('blueimp.fileuploadui', $.blueimp.fileuploadui, {\r\n\r\n        options: {\r\n            // The regular expression for the types of audio files to load,\r\n            // matched against the file type:\r\n            loadAudioFileTypes: /^audio\\/.*$/\r\n        },\r\n\r\n        _audioElement: document.createElement('audio'),\r\n\r\n        processActions: {\r\n\r\n            // Loads the audio file given via data.files and data.index\r\n            // as audio element if the browser supports playing it.\r\n            // Accepts the options fileTypes (regular expression)\r\n            // and maxFileSize (integer) to limit the files to load:\r\n            loadAudio: function (data, options) {\r\n                if (options.disabled) {\r\n                    return data;\r\n                }\r\n                var file = data.files[data.index],\r\n                    url,\r\n                    audio;\r\n                if (this._audioElement.canPlayType &&\r\n                        this._audioElement.canPlayType(file.type) &&\r\n                        ($.type(options.maxFileSize) !== 'number' ||\r\n                            file.size <= options.maxFileSize) &&\r\n                        (!options.fileTypes ||\r\n                            options.fileTypes.test(file.type))) {\r\n                    url = imagex.createObjectURL(file);\r\n                    if (url) {\r\n                        audio = this._audioElement.cloneNode(false);\r\n                        audio.src = url;\r\n                        audio.controls = true;\r\n                        data.audio = audio;\r\n                        return data;\r\n                    }\r\n                }\r\n                return data;\r\n            },\r\n\r\n            // Sets the audio element as a property of the file object:\r\n            setAudio: function (data, options) {\r\n                if (data.audio && !options.disabled) {\r\n                    data.files[data.index][options.name || 'preview'] = data.audio;\r\n                }\r\n                return data;\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n\r\n});\r\n\ndefine('skylark-blueimp-uploader/addons/video',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-utils-imagex\",\r\n    'skylark-jquery',\r\n    \"../fileupload-ui\"\r\n],function (langx,eventer,imagex,$) {\r\n    'use strict';\r\n\r\n    // Prepend to the default processQueue:\r\n    $.blueimp.fileuploadui.prototype.options.processQueue.unshift(\r\n        {\r\n            action: 'loadVideo',\r\n            // Use the action as prefix for the \"@\" options:\r\n            prefix: true,\r\n            fileTypes: '@',\r\n            maxFileSize: '@',\r\n            disabled: '@disableVideoPreview'\r\n        },\r\n        {\r\n            action: 'setVideo',\r\n            name: '@videoPreviewName',\r\n            disabled: '@disableVideoPreview'\r\n        }\r\n    );\r\n\r\n    // The File Upload Video Preview plugin extends the fileupload widget\r\n    // with video preview functionality:\r\n    $.widget('blueimp.fileuploadui', $.blueimp.fileuploadui, {\r\n\r\n        options: {\r\n            // The regular expression for the types of video files to load,\r\n            // matched against the file type:\r\n            loadVideoFileTypes: /^video\\/.*$/\r\n        },\r\n\r\n        _videoElement: document.createElement('video'),\r\n\r\n        processActions: {\r\n\r\n            // Loads the video file given via data.files and data.index\r\n            // as video element if the browser supports playing it.\r\n            // Accepts the options fileTypes (regular expression)\r\n            // and maxFileSize (integer) to limit the files to load:\r\n            loadVideo: function (data, options) {\r\n                if (options.disabled) {\r\n                    return data;\r\n                }\r\n                var file = data.files[data.index],\r\n                    url,\r\n                    video;\r\n                if (this._videoElement.canPlayType &&\r\n                        this._videoElement.canPlayType(file.type) &&\r\n                        ($.type(options.maxFileSize) !== 'number' ||\r\n                            file.size <= options.maxFileSize) &&\r\n                        (!options.fileTypes ||\r\n                            options.fileTypes.test(file.type))) {\r\n                    url = loadImage.createObjectURL(file);\r\n                    if (url) {\r\n                        video = this._videoElement.cloneNode(false);\r\n                        video.src = url;\r\n                        video.controls = true;\r\n                        data.video = video;\r\n                        return data;\r\n                    }\r\n                }\r\n                return data;\r\n            },\r\n\r\n            // Sets the video element as a property of the file object:\r\n            setVideo: function (data, options) {\r\n                if (data.video && !options.disabled) {\r\n                    data.files[data.index][options.name || 'preview'] = data.video;\r\n                }\r\n                return data;\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n\r\n});\r\n\ndefine('skylark-blueimp-uploader/addons/validate',[\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    'skylark-jquery',\r\n    \"../fileupload-ui\"\r\n],function (langx,eventer,$) {\r\n    'use strict';\r\n\r\n    // Append to the default processQueue:\r\n    $.blueimp.fileuploadui.prototype.options.processQueue.push(\r\n        {\r\n            action: 'validate',\r\n            // Always trigger this action,\r\n            // even if the previous action was rejected: \r\n            always: true,\r\n            // Options taken from the global options map:\r\n            acceptFileTypes: '@',\r\n            maxFileSize: '@',\r\n            minFileSize: '@',\r\n            maxNumberOfFiles: '@',\r\n            disabled: '@disableValidation'\r\n        }\r\n    );\r\n\r\n    // The File Upload Validation plugin extends the fileupload widget\r\n    // with file validation functionality:\r\n    $.widget('blueimp.fileuploadui', $.blueimp.fileuploadui, {\r\n\r\n        options: {\r\n            /*\r\n            // The regular expression for allowed file types, matches\r\n            // against either file type or file name:\r\n            acceptFileTypes: /(\\.|\\/)(gif|jpe?g|png)$/i,\r\n            // The maximum allowed file size in bytes:\r\n            maxFileSize: 10000000, // 10 MB\r\n            // The minimum allowed file size in bytes:\r\n            minFileSize: undefined, // No minimal file size\r\n            // The limit of files to be uploaded:\r\n            maxNumberOfFiles: 10,\r\n            */\r\n\r\n            // Function returning the current number of files,\r\n            // has to be overriden for maxNumberOfFiles validation:\r\n            getNumberOfFiles: $.noop,\r\n\r\n            // Error and info messages:\r\n            messages: {\r\n                maxNumberOfFiles: 'Maximum number of files exceeded',\r\n                acceptFileTypes: 'File type not allowed',\r\n                maxFileSize: 'File is too large',\r\n                minFileSize: 'File is too small'\r\n            }\r\n        },\r\n\r\n        processActions: {\r\n\r\n            validate: function (data, options) {\r\n                if (options.disabled) {\r\n                    return data;\r\n                }\r\n                var dfd = $.Deferred(),\r\n                    settings = this.options,\r\n                    file = data.files[data.index],\r\n                    fileSize;\r\n                if (options.minFileSize || options.maxFileSize) {\r\n                    fileSize = file.size;\r\n                }\r\n                if ($.type(options.maxNumberOfFiles) === 'number' &&\r\n                        (settings.getNumberOfFiles() || 0) + data.files.length >\r\n                            options.maxNumberOfFiles) {\r\n                    file.error = settings.i18n('maxNumberOfFiles');\r\n                } else if (options.acceptFileTypes &&\r\n                        !(options.acceptFileTypes.test(file.type) ||\r\n                        options.acceptFileTypes.test(file.name))) {\r\n                    file.error = settings.i18n('acceptFileTypes');\r\n                } else if (fileSize > options.maxFileSize) {\r\n                    file.error = settings.i18n('maxFileSize');\r\n                } else if ($.type(fileSize) === 'number' &&\r\n                        fileSize < options.minFileSize) {\r\n                    file.error = settings.i18n('minFileSize');\r\n                } else {\r\n                    delete file.error;\r\n                }\r\n                if (file.error || data.files.error) {\r\n                    data.files.error = true;\r\n                    dfd.rejectWith(this, [data]);\r\n                } else {\r\n                    dfd.resolveWith(this, [data]);\r\n                }\r\n                return dfd.promise();\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n\r\n});\r\n\ndefine('skylark-blueimp-uploader/main',[\r\n\t\"./fileupload-ui\",\r\n\t\"./addons/image\",\r\n\t\"./addons/audio\",\r\n\t\"./addons/video\",\r\n\t\"./addons/validate\"\r\n],function($) {\r\n\treturn $;\r\n});\ndefine('skylark-blueimp-uploader', ['skylark-blueimp-uploader/main'], function (main) { return main; });\n\n"]}