{"version":3,"sources":["fileupload-ui.js"],"names":["define","langx","eventer","uploader","$","tmpl","widget","processActions","_processFile","data","originalData","skylark","that","this","funcs","map","processQueue","setting","action","call","async","waterful","_transformProcessQueue","options","each","settings","prefix","key","value","type","charAt","slice","toUpperCase","push","processing","_processing","process","extend","length","_trigger","files","index","opts","func","errorThrown","Deferred","rejectWith","promise","_processingQueue","pipe","always","autoUpload","uploadTemplateId","downloadTemplateId","filesContainer","undefined","prependFiles","dataType","getNumberOfFiles","children","not","getFilesFromResponse","result","isArray","add","e","$this","context","_renderUpload","addClass","_forceReflow","_transition","fileuploadui","find","text","_formatFileSize","size","removeClass","_renderPreviews","done","prop","submit","fail","error","send","isDefaultPrevented","substr","support","transition","attr","first","css","template","deferred","file","_addFinishedDeferreds","node","_renderDownload","replaceAll","resolve","remove","progress","Math","floor","loaded","total","progressall","globalProgressNode","extendedProgressNode","html","_renderExtendedProgress","start","_resetFinishedDeferreds","stop","when","apply","_getFinishedDeferreds","processstart","processstop","destroy","removeNode","url","ajax","_finishedUploads","_enableDragToDesktop","link","name","bind","originalEvent","dataTransfer","setData","join","ignore","bytes","toFixed","_formatBitrate","bits","_formatTime","seconds","date","Date","days","getUTCHours","getUTCMinutes","getUTCSeconds","_formatPercentage","floatValue","bitrate","_renderTemplate","formatFileSize","templatesContainer","elm","append","preview","uploadTemplate","downloadTemplate","end","_startHandler","preventDefault","button","currentTarget","closest","_cancelHandler","abort","_deleteHandler","offsetWidth","dfd","hasClass","is","target","unbind","resolveWith","toggleClass","_initButtonBarEventHandlers","fileUploadButtonBar","element","filesList","_on","click","change","_destroyButtonBarEventHandlers","_off","_initEventHandlers","click .start","click .cancel","click .delete","_destroyEventHandlers","_super","_enableFileInputButton","parent","_disableFileInputButton","_initTemplates","document","createElement","_initFilesContainer","_initSpecialOptions","_create","_uploader","fileInput","enable","wasDisabled","disabled","disable"],"mappings":"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","file":"../fileupload-ui.js","sourcesContent":["define([\r\n    \"skylark-langx/langx\",\r\n    \"skylark-utils-dom/eventer\",\r\n    \"skylark-utils-filer/uploader\",\r\n    \"skylark-jquery\",\r\n    \"./tmpl\"\r\n],function (langx,eventer,uploader,$,tmpl) {\r\n\r\n    'use strict';\r\n\r\n//    $.blueimp.fileupload.prototype._specialOptions.push(\r\n//        'filesContainer',\r\n//        'uploadTemplateId',\r\n//        'downloadTemplateId'\r\n//    );\r\n\r\n    // The UI version extends the file upload widget\r\n    // and adds complete user interface interaction:\r\n    $.widget('blueimp.fileuploadui',  {\r\n        processActions: {\r\n            /*\r\n            log: function (data, options) {\r\n                console[options.type](\r\n                    'Processing \"' + data.files[data.index].name + '\"'\r\n                );\r\n            }\r\n            */\r\n        },\r\n\r\n        _processFile: function (data, originalData) {\r\n            /*\r\n            var that = this,\r\n                dfd = $.Deferred().resolveWith(that, [data]),\r\n                chain = dfd.promise();\r\n            this._trigger('process', null, data);\r\n            $.each(data.processQueue, function (i, settings) {\r\n                var func = function (data) {\r\n                    if (originalData.errorThrown) {\r\n                        return $.Deferred()\r\n                                .rejectWith(that, [originalData]).promise();\r\n                    }\r\n                    return that.processActions[settings.action].call(\r\n                        that,\r\n                        data,\r\n                        settings\r\n                    );\r\n                };\r\n                chain = chain.pipe(func, settings.always && func);\r\n            });\r\n            chain\r\n                .done(function () {\r\n                    that._trigger('processdone', null, data);\r\n                    that._trigger('processalways', null, data);\r\n                })\r\n                .fail(function () {\r\n                    that._trigger('processfail', null, data);\r\n                    that._trigger('processalways', null, data);\r\n                });\r\n            return chain;\r\n            */\r\n            var langx = $.skylark.langx,\r\n                that = this;\r\n            var funcs = langx.map(data.processQueue,function(setting) {\r\n                var func = function (data) {\r\n                    return that.processActions[setting.action].call(\r\n                        that,\r\n                        data,\r\n                        setting\r\n                    );\r\n                };\r\n                return func;                \r\n            });\r\n            return langx.async.waterful(funcs,[data],that);\r\n        },\r\n\r\n        // Replaces the settings of each processQueue item that\r\n        // are strings starting with an \"@\", using the remaining\r\n        // substring as key for the option map,\r\n        // e.g. \"@autoUpload\" is replaced with options.autoUpload:\r\n        _transformProcessQueue: function (options) {\r\n            var processQueue = [];\r\n            $.each(options.processQueue, function () {\r\n                var settings = {},\r\n                    action = this.action,\r\n                    prefix = this.prefix === true ? action : this.prefix;\r\n                $.each(this, function (key, value) {\r\n                    if ($.type(value) === 'string' &&\r\n                            value.charAt(0) === '@') {\r\n                        settings[key] = options[\r\n                            value.slice(1) || (prefix ? prefix +\r\n                                key.charAt(0).toUpperCase() + key.slice(1) : key)\r\n                        ];\r\n                    } else {\r\n                        settings[key] = value;\r\n                    }\r\n\r\n                });\r\n                processQueue.push(settings);\r\n            });\r\n            options.processQueue = processQueue;\r\n        },\r\n\r\n        // Returns the number of files currently in the processsing queue:\r\n        processing: function () {\r\n            return this._processing;\r\n        },\r\n\r\n        // Processes the files given as files property of the data parameter,\r\n        // returns a Promise object that allows to bind callbacks:\r\n        process: function (data) {\r\n            var that = this,\r\n                options = $.extend({}, this.options, data);\r\n            if (options.processQueue && options.processQueue.length) {\r\n                this._transformProcessQueue(options);\r\n                if (this._processing === 0) {\r\n                    this._trigger('processstart');\r\n                }\r\n                $.each(data.files, function (index) {\r\n                    var opts = index ? $.extend({}, options) : options,\r\n                        func = function () {\r\n                            if (data.errorThrown) {\r\n                                return $.Deferred()\r\n                                        .rejectWith(that, [data]).promise();\r\n                            }\r\n                            return that._processFile(opts, data);\r\n                        };\r\n                    opts.index = index;\r\n                    that._processing += 1;\r\n                    that._processingQueue = that._processingQueue.pipe(func, func)\r\n                        .always(function () {\r\n                            that._processing -= 1;\r\n                            if (that._processing === 0) {\r\n                                that._trigger('processstop');\r\n                            }\r\n                        });\r\n                });\r\n            }\r\n            return this._processingQueue;\r\n        },\r\n\r\n\r\n        options: {\r\n            // The list of processing actions:\r\n            processQueue: [\r\n                /*\r\n                {\r\n                    action: 'log',\r\n                    type: 'debug'\r\n                }\r\n                */\r\n            ],\r\n\r\n\r\n\r\n            // By default, files added to the widget are uploaded as soon\r\n            // as the user clicks on the start buttons. To enable automatic\r\n            // uploads, set the following option to true:\r\n            autoUpload: false,\r\n            // The ID of the upload template:\r\n            uploadTemplateId: 'template-upload',\r\n            // The ID of the download template:\r\n            downloadTemplateId: 'template-download',\r\n            // The container for the list of files. If undefined, it is set to\r\n            // an element with class \"files\" inside of the widget element:\r\n            filesContainer: undefined,\r\n            // By default, files are appended to the files container.\r\n            // Set the following option to true, to prepend files instead:\r\n            prependFiles: false,\r\n            // The expected data type of the upload response, sets the dataType\r\n            // option of the $.ajax upload requests:\r\n            dataType: 'json',\r\n\r\n            // Function returning the current number of files,\r\n            // used by the maxNumberOfFiles validation:\r\n            getNumberOfFiles: function () {\r\n                return this.filesContainer.children()\r\n                    .not('.processing').length;\r\n            },\r\n\r\n            // Callback to retrieve the list of files from the server response:\r\n            getFilesFromResponse: function (data) {\r\n                if (data.result && $.isArray(data.result.files)) {\r\n                    return data.result.files;\r\n                }\r\n                return [];\r\n            },\r\n\r\n            // The add callback is invoked as soon as files are added to the fileupload\r\n            // widget (via file input selection, drag & drop or add API call).\r\n            // See the basic file upload widget for more information:\r\n            add: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var $this = $(this),\r\n                    that = $this.data('blueimp-fileuploadui') ||\r\n                        $this.data('fileupload'),\r\n                    options = that.options;\r\n                data.context = that._renderUpload(data.files)\r\n                    .data('data', data)\r\n                    .addClass('processing');\r\n                options.filesContainer[\r\n                    options.prependFiles ? 'prepend' : 'append'\r\n                ](data.context);\r\n                that._forceReflow(data.context);\r\n                that._transition(data.context);\r\n//                data.process(function () {\r\n//                    return $this.fileupload('process', data);\r\n//                }).always(function () {\r\n                $this.fileuploadui('process', data).always(function () {\r\n                    data.context.each(function (index) {\r\n                        $(this).find('.size').text(\r\n                            that._formatFileSize(data.files[index].size)\r\n                        );\r\n                    }).removeClass('processing');\r\n                    that._renderPreviews(data);\r\n                }).done(function () {\r\n                    data.context.find('.start').prop('disabled', false);\r\n                    if ((that._trigger('added', null,data) !== false) &&\r\n                            (options.autoUpload || data.autoUpload) &&\r\n                            data.autoUpload !== false) {\r\n                        data.submit();\r\n                    }\r\n                }).fail(function () {\r\n                    if (data.files.error) {\r\n                        data.context.each(function (index) {\r\n                            var error = data.files[index].error;\r\n                            if (error) {\r\n                                $(this).find('.error').text(error);\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            },\r\n            // Callback for the start of each file upload request:\r\n            send: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload');\r\n                if (data.context && data.dataType &&\r\n                        data.dataType.substr(0, 6) === 'iframe') {\r\n                    // Iframe Transport does not support progress events.\r\n                    // In lack of an indeterminate progress bar, we set\r\n                    // the progress to 100%, showing the full animated bar:\r\n                    data.context\r\n                        .find('.progress').addClass(\r\n                            !$.support.transition && 'progress-animated'\r\n                        )\r\n                        .attr('aria-valuenow', 100)\r\n                        .children().first().css(\r\n                            'width',\r\n                            '100%'\r\n                        );\r\n                }\r\n                return that._trigger('sent', null,data);\r\n            },\r\n            // Callback for successful uploads:\r\n            done: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    getFilesFromResponse = data.getFilesFromResponse ||\r\n                        that.options.getFilesFromResponse,\r\n                    files = getFilesFromResponse(data),\r\n                    template,\r\n                    deferred;\r\n                if (data.context) {\r\n                    data.context.each(function (index) {\r\n                        var file = files[index] ||\r\n                                {error: 'Empty file upload result'};\r\n                        deferred = that._addFinishedDeferreds();\r\n                        that._transition($(this)).done(\r\n                            function () {\r\n                                var node = $(this);\r\n//                                template = that._renderDownload([file]);\r\n                                template = that._renderDownload([file])\r\n                                    .replaceAll(node);\r\n                                that._forceReflow(template);\r\n                                that._transition(template).done(\r\n                                    function () {\r\n                                        data.context = $(this);\r\n                                        that._trigger('completed', null,data);\r\n                                        that._trigger('finished', null,data);\r\n                                        deferred.resolve();\r\n                                    }\r\n                                );\r\n                            }\r\n                        );\r\n                    });\r\n                } else {\r\n                    template = that._renderDownload(files)[\r\n                        that.options.prependFiles ? 'prependTo' : 'appendTo'\r\n                    ](that.options.filesContainer);\r\n                    that._forceReflow(template);\r\n                    deferred = that._addFinishedDeferreds();\r\n                    that._transition(template).done(\r\n                        function () {\r\n                            data.context = $(this);\r\n                            that._trigger('completed', null,data);\r\n                            that._trigger('finished', null,data);\r\n                            deferred.resolve();\r\n                        }\r\n                    );\r\n                }\r\n            },\r\n            // Callback for failed (abort or error) uploads:\r\n            fail: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    template,\r\n                    deferred;\r\n                if (data.context) {\r\n                    data.context.each(function (index) {\r\n                        if (data.errorThrown !== 'abort') {\r\n                            var file = data.files[index];\r\n                            file.error = file.error || data.errorThrown ||\r\n                                true;\r\n                            deferred = that._addFinishedDeferreds();\r\n                            that._transition($(this)).done(\r\n                                function () {\r\n                                    var node = $(this);\r\n                                    template = that._renderDownload([file])\r\n                                        .replaceAll(node);\r\n                                    that._forceReflow(template);\r\n                                    that._transition(template).done(\r\n                                        function () {\r\n                                            data.context = $(this);\r\n                                            that._trigger('failed', null,data);\r\n                                            that._trigger('finished', null,data);\r\n                                            deferred.resolve();\r\n                                        }\r\n                                    );\r\n                                }\r\n                            );\r\n                        } else {\r\n                            deferred = that._addFinishedDeferreds();\r\n                            that._transition($(this)).done(\r\n                                function () {\r\n                                    $(this).remove();\r\n                                    that._trigger('failed', null,data);\r\n                                    that._trigger('finished', null,data);\r\n                                    deferred.resolve();\r\n                                }\r\n                            );\r\n                        }\r\n                    });\r\n                } else if (data.errorThrown !== 'abort') {\r\n                    data.context = that._renderUpload(data.files)[\r\n                        that.options.prependFiles ? 'prependTo' : 'appendTo'\r\n                    ](that.options.filesContainer)\r\n                        .data('data', data);\r\n                    that._forceReflow(data.context);\r\n                    deferred = that._addFinishedDeferreds();\r\n                    that._transition(data.context).done(\r\n                        function () {\r\n                            data.context = $(this);\r\n                            that._trigger('failed', null,data);\r\n                            that._trigger('finished', null,data);\r\n                            deferred.resolve();\r\n                        }\r\n                    );\r\n                } else {\r\n                    that._trigger('failed', null,data);\r\n                    that._trigger('finished', null,data);\r\n                    that._addFinishedDeferreds().resolve();\r\n                }\r\n            },\r\n            // Callback for upload progress events:\r\n            progress: function (e, data) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var progress = Math.floor(data.loaded / data.total * 100);\r\n                if (data.context) {\r\n                    data.context.each(function () {\r\n                        $(this).find('.progress')\r\n                            .attr('aria-valuenow', progress)\r\n                            .children().first().css(\r\n                                'width',\r\n                                progress + '%'\r\n                            );\r\n                    });\r\n                }\r\n            },\r\n            // Callback for global upload progress events:\r\n            progressall: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var $this = $(this),\r\n                    progress = Math.floor(data.loaded / data.total * 100),\r\n                    globalProgressNode = $this.find('.fileupload-progress'),\r\n                    extendedProgressNode = globalProgressNode\r\n                        .find('.progress-extended');\r\n                if (extendedProgressNode.length) {\r\n                    extendedProgressNode.html(\r\n                        ($this.data('blueimp-fileuploadui') || $this.data('fileupload'))\r\n                            ._renderExtendedProgress(data)\r\n                    );\r\n                }\r\n                globalProgressNode\r\n                    .find('.progress')\r\n                    .attr('aria-valuenow', progress)\r\n                    .children().first().css(\r\n                        'width',\r\n                        progress + '%'\r\n                    );\r\n            },\r\n            // Callback for uploads start, equivalent to the global ajaxStart event:\r\n            start: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload');\r\n                that._resetFinishedDeferreds();\r\n                that._transition($(this).find('.fileupload-progress')).done(\r\n                    function () {\r\n                        that._trigger('started', null);\r\n                    }\r\n                );\r\n            },\r\n            // Callback for uploads stop, equivalent to the global ajaxStop event:\r\n            stop: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    deferred = that._addFinishedDeferreds();\r\n                $.when.apply($, that._getFinishedDeferreds())\r\n                    .done(function () {\r\n                        that._trigger('stopped', null);\r\n                    });\r\n                that._transition($(this).find('.fileupload-progress')).done(\r\n                    function () {\r\n                        $(this).find('.progress')\r\n                            .attr('aria-valuenow', '0')\r\n                            .children().first().css('width', '0%');\r\n                        $(this).find('.progress-extended').html('&nbsp;');\r\n                        deferred.resolve();\r\n                    }\r\n                );\r\n            },\r\n            processstart: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                $(this).addClass('fileupload-processing');\r\n            },\r\n            processstop: function (e) {\r\n                if (e.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                $(this).removeClass('fileupload-processing');\r\n            },\r\n            // Callback for file deletion:\r\n            destroy: function (e, data) {\r\n                //if (e.isDefaultPrevented()) {\r\n                //    return false;\r\n                //}\r\n                var that = $(this).data('blueimp-fileuploadui') ||\r\n                        $(this).data('fileupload'),\r\n                    removeNode = function () {\r\n                        that._transition(data.context).done(\r\n                            function () {\r\n                                $(this).remove();\r\n                                that._trigger('destroyed', null,data);\r\n                            }\r\n                        );\r\n                    };\r\n                if (data.url) {\r\n                    data.dataType = data.dataType || that.options.dataType;\r\n                    $.ajax(data).done(removeNode).fail(function () {\r\n                        that._trigger('destroyfailed', null,data);\r\n                    });\r\n                } else {\r\n                    removeNode();\r\n                }\r\n            }\r\n        },\r\n\r\n\r\n        _resetFinishedDeferreds: function () {\r\n            this._finishedUploads = [];\r\n        },\r\n\r\n        _addFinishedDeferreds: function (deferred) {\r\n            if (!deferred) {\r\n                deferred = $.Deferred();\r\n            }\r\n            this._finishedUploads.push(deferred);\r\n            return deferred;\r\n        },\r\n\r\n        _getFinishedDeferreds: function () {\r\n            return this._finishedUploads;\r\n        },\r\n\r\n        // Link handler, that allows to download files\r\n        // by drag & drop of the links to the desktop:\r\n        _enableDragToDesktop: function () {\r\n            var link = $(this),\r\n                url = link.prop('href'),\r\n                name = link.prop('download'),\r\n                type = 'application/octet-stream';\r\n            link.bind('dragstart', function (e) {\r\n                try {\r\n                    e.originalEvent.dataTransfer.setData(\r\n                        'DownloadURL',\r\n                        [type, name, url].join(':')\r\n                    );\r\n                } catch (ignore) {}\r\n            });\r\n        },\r\n\r\n        _formatFileSize: function (bytes) {\r\n            if (typeof bytes !== 'number') {\r\n                return '';\r\n            }\r\n            if (bytes >= 1000000000) {\r\n                return (bytes / 1000000000).toFixed(2) + ' GB';\r\n            }\r\n            if (bytes >= 1000000) {\r\n                return (bytes / 1000000).toFixed(2) + ' MB';\r\n            }\r\n            return (bytes / 1000).toFixed(2) + ' KB';\r\n        },\r\n\r\n        _formatBitrate: function (bits) {\r\n            if (typeof bits !== 'number') {\r\n                return '';\r\n            }\r\n            if (bits >= 1000000000) {\r\n                return (bits / 1000000000).toFixed(2) + ' Gbit/s';\r\n            }\r\n            if (bits >= 1000000) {\r\n                return (bits / 1000000).toFixed(2) + ' Mbit/s';\r\n            }\r\n            if (bits >= 1000) {\r\n                return (bits / 1000).toFixed(2) + ' kbit/s';\r\n            }\r\n            return bits.toFixed(2) + ' bit/s';\r\n        },\r\n\r\n        _formatTime: function (seconds) {\r\n            var date = new Date(seconds * 1000),\r\n                days = Math.floor(seconds / 86400);\r\n            days = days ? days + 'd ' : '';\r\n            return days +\r\n                ('0' + date.getUTCHours()).slice(-2) + ':' +\r\n                ('0' + date.getUTCMinutes()).slice(-2) + ':' +\r\n                ('0' + date.getUTCSeconds()).slice(-2);\r\n        },\r\n\r\n        _formatPercentage: function (floatValue) {\r\n            return (floatValue * 100).toFixed(2) + ' %';\r\n        },\r\n\r\n        _renderExtendedProgress: function (data) {\r\n            return this._formatBitrate(data.bitrate) + ' | ' +\r\n                this._formatTime(\r\n                    (data.total - data.loaded) * 8 / data.bitrate\r\n                ) + ' | ' +\r\n                this._formatPercentage(\r\n                    data.loaded / data.total\r\n                ) + ' | ' +\r\n                this._formatFileSize(data.loaded) + ' / ' +\r\n                this._formatFileSize(data.total);\r\n        },\r\n\r\n        _renderTemplate: function (func, files) {\r\n            if (!func) {\r\n                return $();\r\n            }\r\n            var result = func({\r\n                files: files,\r\n                formatFileSize: this._formatFileSize,\r\n                options: this.options\r\n            });\r\n            if (result instanceof $) {\r\n                return result;\r\n            }\r\n            return $(this.options.templatesContainer).html(result).children();\r\n        },\r\n\r\n        _renderPreviews: function (data) {\r\n            data.context.find('.preview').each(function (index, elm) {\r\n                $(elm).append(data.files[index].preview);\r\n            });\r\n        },\r\n\r\n        _renderUpload: function (files) {\r\n            return this._renderTemplate(\r\n                this.options.uploadTemplate,\r\n                files\r\n            );\r\n        },\r\n\r\n        _renderDownload: function (files) {\r\n            return this._renderTemplate(\r\n                this.options.downloadTemplate,\r\n                files\r\n            ).find('a[download]').each(this._enableDragToDesktop).end();\r\n        },\r\n\r\n        _startHandler: function (e) {\r\n            e.preventDefault();\r\n            var button = $(e.currentTarget),\r\n                template = button.closest('.template-upload'),\r\n                data = template.data('data');\r\n            button.prop('disabled', true);\r\n            if (data && data.submit) {\r\n                data.submit();\r\n            }\r\n        },\r\n\r\n        _cancelHandler: function (e) {\r\n            e.preventDefault();\r\n            var template = $(e.currentTarget)\r\n                    .closest('.template-upload,.template-download'),\r\n                data = template.data('data') || {};\r\n            data.context = data.context || template;\r\n            if (data.abort) {\r\n                data.abort();\r\n            } else {\r\n                data.errorThrown = 'abort';\r\n                this._trigger('fail', null,data);\r\n            }\r\n        },\r\n\r\n        _deleteHandler: function (e) {\r\n            e.preventDefault();\r\n            var button = $(e.currentTarget);\r\n            this._trigger('destroy', null, $.extend({\r\n                context: button.closest('.template-download'),\r\n                type: 'DELETE'\r\n            }, button.data()));\r\n        },\r\n\r\n        _forceReflow: function (node) {\r\n            return $.support.transition && node.length &&\r\n                node[0].offsetWidth;\r\n        },\r\n\r\n        _transition: function (node) {\r\n            var dfd = $.Deferred();\r\n            if ($.support.transition && node.hasClass('fade') && node.is(':visible')) {\r\n                node.bind(\r\n                    $.support.transition.end,\r\n                    function (e) {\r\n                        // Make sure we don't respond to other transitions events\r\n                        // in the container element, e.g. from button elements:\r\n                        if (e.target === node[0]) {\r\n                            node.unbind($.support.transition.end);\r\n                            dfd.resolveWith(node);\r\n                        }\r\n                    }\r\n                ).toggleClass('in');\r\n            } else {\r\n                node.toggleClass('in');\r\n                dfd.resolveWith(node);\r\n            }\r\n            return dfd;\r\n        },\r\n\r\n        _initButtonBarEventHandlers: function () {\r\n            var fileUploadButtonBar = this.element.find('.fileupload-buttonbar'),\r\n                filesList = this.options.filesContainer;\r\n            this._on(fileUploadButtonBar.find('.start'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.start').click();\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.cancel'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.cancel').click();\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.delete'), {\r\n                click: function (e) {\r\n                    e.preventDefault();\r\n                    filesList.find('.toggle:checked')\r\n                        .closest('.template-download')\r\n                        .find('.delete').click();\r\n                    fileUploadButtonBar.find('.toggle')\r\n                        .prop('checked', false);\r\n                }\r\n            });\r\n            this._on(fileUploadButtonBar.find('.toggle'), {\r\n                change: function (e) {\r\n                    filesList.find('.toggle').prop(\r\n                        'checked',\r\n                        $(e.currentTarget).is(':checked')\r\n                    );\r\n                }\r\n            });\r\n        },\r\n\r\n        _destroyButtonBarEventHandlers: function () {\r\n            this._off(\r\n                this.element.find('.fileupload-buttonbar')\r\n                    .find('.start, .cancel, .delete'),\r\n                'click'\r\n            );\r\n            this._off(\r\n                this.element.find('.fileupload-buttonbar .toggle'),\r\n                'change.'\r\n            );\r\n        },\r\n\r\n        _initEventHandlers: function () {\r\n            //this._super();\r\n            this._on(this.options.filesContainer, {\r\n                'click .start': this._startHandler,\r\n                'click .cancel': this._cancelHandler,\r\n                'click .delete': this._deleteHandler\r\n            });\r\n            this._initButtonBarEventHandlers();\r\n        },\r\n\r\n        _destroyEventHandlers: function () {\r\n            this._destroyButtonBarEventHandlers();\r\n            this._off(this.options.filesContainer, 'click');\r\n            this._super();\r\n        },\r\n\r\n        _enableFileInputButton: function () {\r\n            this.element.find('.fileinput-button input')\r\n                .prop('disabled', false)\r\n                .parent().removeClass('disabled');\r\n        },\r\n\r\n        _disableFileInputButton: function () {\r\n            this.element.find('.fileinput-button input')\r\n                .prop('disabled', true)\r\n                .parent().addClass('disabled');\r\n        },\r\n\r\n        _initTemplates: function () {\r\n            var options = this.options;\r\n            options.templatesContainer = this.document[0].createElement(\r\n                options.filesContainer.prop('nodeName')\r\n            );\r\n            if (tmpl) {\r\n                if (options.uploadTemplateId) {\r\n                    options.uploadTemplate = tmpl(options.uploadTemplateId);\r\n                }\r\n                if (options.downloadTemplateId) {\r\n                    options.downloadTemplate = tmpl(options.downloadTemplateId);\r\n                }\r\n            }\r\n        },\r\n\r\n        _initFilesContainer: function () {\r\n            var options = this.options;\r\n            if (options.filesContainer === undefined) {\r\n                options.filesContainer = this.element.find('.files');\r\n            } else if (!(options.filesContainer instanceof $)) {\r\n                options.filesContainer = $(options.filesContainer);\r\n            }\r\n        },\r\n\r\n        _initSpecialOptions: function () {\r\n            //this._super();\r\n            this._initFilesContainer();\r\n            this._initTemplates();\r\n        },\r\n\r\n        _create: function () {\r\n            this._super();\r\n\r\n            this._processing = 0;\r\n            this._processingQueue = $.Deferred().resolveWith(this)\r\n                .promise();\r\n\r\n\r\n            this._initSpecialOptions();\r\n            this._initEventHandlers();\r\n\r\n            //$(this.element).fileupload(this.options);\r\n            this._uploader = uploader(this.element,this.options);\r\n            this._resetFinishedDeferreds();\r\n            if (!$.support.fileInput) {\r\n                this._disableFileInputButton();\r\n            }\r\n        },\r\n\r\n        enable: function () {\r\n            var wasDisabled = false;\r\n            if (this.options.disabled) {\r\n                wasDisabled = true;\r\n            }\r\n            this._super();\r\n            if (wasDisabled) {\r\n                this.element.find('input, button').prop('disabled', false);\r\n                this._enableFileInputButton();\r\n            }\r\n        },\r\n\r\n        disable: function () {\r\n            if (!this.options.disabled) {\r\n                this.element.find('input, button').prop('disabled', true);\r\n                this._disableFileInputButton();\r\n            }\r\n            this._super();\r\n        }\r\n\r\n    });\r\n\r\n    return $;\r\n});\r\n"]}